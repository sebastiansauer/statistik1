<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="keywords" content="Statistik, Prognose, Modellierung, R, Datenanalyse, Regression">
<meta name="description" content="Einführung in die Statistik mit einem Schwerpunkt auf Prognose-Modellierung">
<title>9&nbsp; Geradenmodelle 1 – Statistik1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./090-regression2.html" rel="next">
<link href="./070-zusammenhaenge.html" rel="prev">
<link href="./img/statistik1_icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0c3ef1a7a266e32c8f1c7e546cf8cabb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-2f7cced78de7748216b8364af62012d1.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-0c3ef1a7a266e32c8f1c7e546cf8cabb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/downloadthis-1.9.1/downloadthis.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./080-regression1.html">Geradenmodelle</a></li><li class="breadcrumb-item"><a href="./080-regression1.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geradenmodelle 1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./img/statistik1_icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistik1</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/sebastiansauer/statistik1" title="Quellcode" class="quarto-navigation-tool px-1" aria-label="Quellcode"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Dunkelmodus umschalten"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Lesemodus umschalten">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vorwort</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005-orga.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Organisatorisches</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Vorbereiten</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-rahmen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Rahmen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Daten einlesen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-aufbereiten.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Daten umformen</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Grundlagen des Modellieren</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-verbildlichen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Daten verbildlichen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-zusammenfassen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Punktmodelle 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060-modellguete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modellgüte</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070-zusammenhaenge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Punktmodelle 2</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Geradenmodelle</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080-regression1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geradenmodelle 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./090-regression2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Geradenmodelle 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literatur</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Anhang</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Definitionen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-mariokart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Data-Dictionary für Mariokart</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130-autor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Zum Autor</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li>
<a href="#einstieg" id="toc-einstieg" class="nav-link active" data-scroll-target="#einstieg"><span class="header-section-number">9.1</span> Einstieg</a>
  <ul class="collapse">
<li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">9.1.1</span> Lernziele</a></li>
  </ul>
</li>
  <li>
<a href="#vorhersagen" id="toc-vorhersagen" class="nav-link" data-scroll-target="#vorhersagen"><span class="header-section-number">9.2</span> Vorhersagen</a>
  <ul class="collapse">
<li><a href="#vorhersagen-ohne-uv" id="toc-vorhersagen-ohne-uv" class="nav-link" data-scroll-target="#vorhersagen-ohne-uv"><span class="header-section-number">9.2.1</span> Vorhersagen ohne UV</a></li>
  <li><a href="#vorhersagen-mit-uv" id="toc-vorhersagen-mit-uv" class="nav-link" data-scroll-target="#vorhersagen-mit-uv"><span class="header-section-number">9.2.2</span> Vorhersagen mit UV</a></li>
  </ul>
</li>
  <li>
<a href="#geradenmodelle" id="toc-geradenmodelle" class="nav-link" data-scroll-target="#geradenmodelle"><span class="header-section-number">9.3</span> Geradenmodelle</a>
  <ul class="collapse">
<li><a href="#achsenabschnitt-und-steigung-definieren-eine-gerade" id="toc-achsenabschnitt-und-steigung-definieren-eine-gerade" class="nav-link" data-scroll-target="#achsenabschnitt-und-steigung-definieren-eine-gerade"><span class="header-section-number">9.3.1</span> Achsenabschnitt und Steigung definieren eine Gerade</a></li>
  <li><a href="#spezifikation-eines-geradenmodells" id="toc-spezifikation-eines-geradenmodells" class="nav-link" data-scroll-target="#spezifikation-eines-geradenmodells"><span class="header-section-number">9.3.2</span> Spezifikation eines Geradenmodells</a></li>
  <li><a href="#vorhersagefehler" id="toc-vorhersagefehler" class="nav-link" data-scroll-target="#vorhersagefehler"><span class="header-section-number">9.3.3</span> Vorhersagefehler</a></li>
  <li><a href="#berechnung-der-modellkoeffizienten" id="toc-berechnung-der-modellkoeffizienten" class="nav-link" data-scroll-target="#berechnung-der-modellkoeffizienten"><span class="header-section-number">9.3.4</span> Berechnung der Modellkoeffizienten</a></li>
  </ul>
</li>
  <li><a href="#r2-als-ma%C3%9F-der-modellg%C3%BCte" id="toc-r2-als-maß-der-modellgüte" class="nav-link" data-scroll-target="#r2-als-ma%C3%9F-der-modellg%C3%BCte"><span class="header-section-number">9.4</span> <span class="math inline">\(R^2\)</span> als Maß der Modellgüte</a></li>
  <li>
<a href="#sec-interpret-reg-mod" id="toc-sec-interpret-reg-mod" class="nav-link" data-scroll-target="#sec-interpret-reg-mod"><span class="header-section-number">9.5</span> Interpretation eines Regressionsmodells</a>
  <ul class="collapse">
<li><a href="#modellg%C3%BCte" id="toc-modellgüte" class="nav-link" data-scroll-target="#modellg%C3%BCte"><span class="header-section-number">9.5.1</span> Modellgüte</a></li>
  <li><a href="#koeffizienten" id="toc-koeffizienten" class="nav-link" data-scroll-target="#koeffizienten"><span class="header-section-number">9.5.2</span> Koeffizienten</a></li>
  </ul>
</li>
  <li><a href="#wie-man-mit-statistik-l%C3%BCgt" id="toc-wie-man-mit-statistik-lügt" class="nav-link" data-scroll-target="#wie-man-mit-statistik-l%C3%BCgt"><span class="header-section-number">9.6</span> Wie man mit Statistik lügt</a></li>
  <li>
<a href="#fallbeispiel-mariokart" id="toc-fallbeispiel-mariokart" class="nav-link" data-scroll-target="#fallbeispiel-mariokart"><span class="header-section-number">9.7</span> Fallbeispiel Mariokart</a>
  <ul class="collapse">
<li><a href="#der-datenwahrsager-legt-los" id="toc-der-datenwahrsager-legt-los" class="nav-link" data-scroll-target="#der-datenwahrsager-legt-los"><span class="header-section-number">9.7.1</span> Der Datenwahrsager legt los</a></li>
  <li><a href="#vertiefung" id="toc-vertiefung" class="nav-link" data-scroll-target="#vertiefung"><span class="header-section-number">9.7.2</span> Vertiefung</a></li>
  </ul>
</li>
  <li>
<a href="#fallstudie-immobilienpreise" id="toc-fallstudie-immobilienpreise" class="nav-link" data-scroll-target="#fallstudie-immobilienpreise"><span class="header-section-number">9.8</span> Fallstudie Immobilienpreise</a>
  <ul class="collapse">
<li><a href="#hintergrund" id="toc-hintergrund" class="nav-link" data-scroll-target="#hintergrund"><span class="header-section-number">9.8.1</span> Hintergrund</a></li>
  <li><a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten"><span class="header-section-number">9.8.2</span> Daten</a></li>
  <li><a href="#prognosedatei" id="toc-prognosedatei" class="nav-link" data-scroll-target="#prognosedatei"><span class="header-section-number">9.8.3</span> Prognosedatei</a></li>
  <li><a href="#ein-erster-blick-in-die-daten" id="toc-ein-erster-blick-in-die-daten" class="nav-link" data-scroll-target="#ein-erster-blick-in-die-daten"><span class="header-section-number">9.8.4</span> Ein erster Blick in die Daten</a></li>
  <li><a href="#ein-erstes-vorhersagemodell" id="toc-ein-erstes-vorhersagemodell" class="nav-link" data-scroll-target="#ein-erstes-vorhersagemodell"><span class="header-section-number">9.8.5</span> Ein erstes Vorhersagemodell</a></li>
  <li><a href="#vorhersagen-im-test-datensatz-mit-lm_immo2" id="toc-vorhersagen-im-test-datensatz-mit-lm_immo2" class="nav-link" data-scroll-target="#vorhersagen-im-test-datensatz-mit-lm_immo2"><span class="header-section-number">9.8.6</span> Vorhersagen im Test-Datensatz mit <code>lm_immo2</code></a></li>
  <li><a href="#einreichen" id="toc-einreichen" class="nav-link" data-scroll-target="#einreichen"><span class="header-section-number">9.8.7</span> Einreichen!</a></li>
  </ul>
</li>
  <li><a href="#aufgaben" id="toc-aufgaben" class="nav-link" data-scroll-target="#aufgaben"><span class="header-section-number">9.9</span> Aufgaben</a></li>
  <li><a href="#literaturhinweise" id="toc-literaturhinweise" class="nav-link" data-scroll-target="#literaturhinweise"><span class="header-section-number">9.10</span> Literaturhinweise</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/sebastiansauer/statistik1/issues/new" class="toc-action"><i class="bi bi-github"></i>Problem melden</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./080-regression1.html">Geradenmodelle</a></li><li class="breadcrumb-item"><a href="./080-regression1.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geradenmodelle 1</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-gerade1" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geradenmodelle 1</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Schlüsselwörter</div>
    <p>Statistik, Prognose, Modellierung, R, Datenanalyse, Regression</p>
  </div>
</div>

</header><p><span class="math display">\[
\definecolor{ycol}{RGB}{230,159,0}
\definecolor{modelcol}{RGB}{86,180,233}
\definecolor{errorcol}{RGB}{0,158,115}
\definecolor{beta0col}{RGB}{213,94,0}
\definecolor{beta1col}{RGB}{0,114,178}
\definecolor{xcol}{RGB}{204,121,167}
\]</span></p>
<section id="einstieg" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="einstieg">
<span class="header-section-number">9.1</span> Einstieg</h2>
<p>In diesem Kapitel benötigen Sie die üblichen R-Pakete (<code>tidyverse</code>, <code>easystats</code>) und Daten (<code>mariokart</code>), s. <a href="020-R.html#sec-import-mariokart" class="quarto-xref"><span>Kapitel 3.7.3</span></a> und <a href="020-R.html#sec-r-pckgs" class="quarto-xref"><span>Kapitel 3.4</span></a>.</p>
<section id="lernziele" class="level3" data-number="9.1.1"><h3 data-number="9.1.1" class="anchored" data-anchor-id="lernziele">
<span class="header-section-number">9.1.1</span> Lernziele</h3>
<ul>
<li>Sie können ein Punktmodell von einem Geradenmodell begrifflich unterscheiden.</li>
<li>Sie können die Bestandteile eines Geradenmodells aufzählen und erläutern.</li>
<li>Sie können die Güte eines Geradenmodells anhand von Kennzahlen bestimmen.</li>
<li>Sie können Geradenmodelle sowie ihre Modellgüte in R berechnen.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mariokart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/openintro/mariokart.csv"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="vorhersagen" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="vorhersagen">
<span class="header-section-number">9.2</span> Vorhersagen</h2>
<p>Vorhersagen sind eine nützliche Sache, unter (mindestens) folgenden Voraussetzungen: 1. Sie sind präzise; 2. Wir wissen, wie präzise; 3. Jemand interessiert sich für die Vorhersage. Die Methode des Vorhersagens, die wir hier betrachten, nennt man auch <em>lineare Regression</em>.</p>
<section id="vorhersagen-ohne-uv" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="vorhersagen-ohne-uv">
<span class="header-section-number">9.2.1</span> Vorhersagen ohne UV</h3>
<div id="exm-noten-prognose" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.1</strong></span> Nach intensiver Beschäftigung mit Statistik sind Sie allgemein als Daten-Checker bekannt. Viele Studierende fragen Sie um Rat. Eines Tages kommt eine Studentin zu Ihnen, Toni, und fragt: “Welche Statistiknote kann ich in der Klausur erwarten?” Sie entgegnen: “Wie viel hast du denn gelernt?”. Die Antwort: “Sage ich nicht.” Nach kurzem Überlegen geben Sie den Notenschnitt der letzten Klausur als Prognose für diese Person. Dazu rechnen Sie schnell den Notenschnitt (Mittelwert) aus.</p>
<p>Zuerst importieren Sie die Daten der letzten Klausur. Die Syntax in <a href="#lst-noten2-lokal" class="quarto-xref">Listing&nbsp;<span>9.1</span></a> wird bei Ihnen nur funktionieren, wenn auf <em>Ihrem Computer</em> dieser Ordner mit dieser Datei existiert. Andernfalls müssen Sie die Daten erst herunterladen<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell" data-layout-align="center">
<div id="lst-noten2-lokal" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-noten2-lokal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;9.1: Wenn der Datensatz ‘noten2’ im Unterordner ‘Noten’ liegt.
</figcaption><div aria-describedby="lst-noten2-lokal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">noten2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/noten2.csv"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p><a href="#dnldts45834" onclick="fetch('data:text/csv;base64,WCxpZCx4LHkKMSwxLDQwLjgzODc4ODA3MzA4MzMsODIuOTgxNzg3MTIxMDQxNDkKMiwyLDQ3Ljk4NTA2NjEzMzkzNTYwNCw4NC4wMTY5OTQ1ODUwMDEKMywzLDU0LjI5Nzg0NzUyODA2MTIsODAuNzUzMDk3MDg1MDMyNjkKNCw0LDUwLjE5OTE3NTA1NDI3MDUsNzguODE1MzA2MjQ0MDAxNQo1LDUsNTguNjEwNjUwMzA1MjAyMyw3NS43NjA4NTAzODkyOTA5MQo2LDYsNDAuNzQ2NjMwNTA0ODI5OCw4MS42NDMwNzg1MDQ4Mjg0CjcsNyw1NS4xMDIxMTE0MTEyMTA0LDEwNS42Mzc1Mzg3NjYyMTE0CjgsOCw1My43MTAzMTIxMDcyMzc2LDk3LjAzMDMxMDUwNTEzNDYKOSw5LDI1LjE1ODk1MDgxNzg3NTEwMiw2OC42NTY4MzE2NzQ0MzQzCjEwLDEwLDUyLjc3OTQzMjY4Nzk4NzM5NSw4Mi44Mzc3MDExMjYzOTEyMQoxMSwxMSw1OC41OTEwOTA0OTc3NTA0LDEwMC44OTQ3MTExMzEyMzc2CjEyLDEyLDUzLjU5MjcyNjEwMzA1NzUsMTA3LjA0MjQ4ODkwMDQzMgoxMywxMyw1Ni43Nzc3ODMzMTcwNTYyMDUsOTguNzgxNDUwODk4NTgyNgoxNCwxNCw0Ni4xMTQ2NjgxMDQwODQ0LDQ4LjgzMjEwOTAwNTI1NTIwNQoxNSwxNSw1MS42MzExMDc4MTY2NzcxLDk2Ljc1NjA3MDcyMjYzOTQKMTYsMTYsNDEuNDAyNjY4MzcyNjk0NSw3NS43NzUwODE1MDE4NDM0CjE3LDE3LDY2LjYyMTg1NzE2NDMzODYsMTA0LjY5NzI0Nzg4MjUxODQKMTgsMTgsNDMuMDYzNDcyMDYyMjQzNyw4My43ODYwNDY1MTk0NzM3CjE5LDE5LDU5LjQ2NTY2NTQ3NzYzODY5NCwxMTAuNjY5Nzc3MjUzOTAxMQoyMCwyMCwzNi41MDgyNTYzMDU0MzI5LDc5LjUzNTg5MzQyMjcwNTkKMjEsMjEsNDkuODM0MjM2MzY4ODExMzA0LDg2LjQwMDExOTg1OTA2NzcKMjIsMjIsMzMuNjYzNjkyNTY0MzI2OCw4Mi41NzQ4MzczNzE0MTkzCjIzLDIzLDUxLjUzODExNzI1MDc1MzYsNzUuNDI3NTczMzc4OTU0MDEKMjQsMjQsNTAuODQ0NTE2MzMzMTk0MzA2LDk2LjQxMDU0MzI3NzEzMTUKMjUsMjUsNTAuNzY1Nzk0ODQwNjk1MDk0LDExNC4xNjUyMjcxNTUzOTA1CjI2LDI2LDQ3LjY1NTIwOTIwMjUxMjEsOTMuMDgzNDM5ODczMzY5CjI3LDI3LDI1Ljk0ODkxODk1MzQwMzg5Nyw2Mi4xNTk3NTc3NTU1NzgyCjI4LDI4LDQ3Ljg0ODIzMzc0OTU5NDMsODguNTk1MzQxNzg1NjM2OQoyOSwyOSw2OS42MzIxODU0NTUwOTM5LDExMS44Mjc5MjkxOTU0NTU3CjMwLDMwLDU3Ljg3NjM4NTUxNDk0NDQsOTcuNTI4MDM1NTQ2NzgyNQozMSwzMSwyOS4zMDU0NDE3MzM1NTQxOTcsODUuMTkzODMyMDQ5OTkzOQozMiwzMiw1MS40MTU4OTI3MjIzOTAxLDg1LjIwODU0Njk2MTI5NjYKMzMsMzMsNTIuNTcxNDY0OTQxNjg0NTk2LDkyLjgxOTQzMTA0MjgxMDkKMzQsMzQsNTcuOTAwOTg5NDUwNDYyMzA1LDg4LjI1MjM1MjI4MjM4NDgKMzUsMzUsNDUuODc3NDI2Njk0NjU5NjA0LDkzLjYzODM4Njg1NDMyCjM2LDM2LDU1LjQ0NzAzOTk4MTg0MDEwNiw5Ni4wMzY1OTgyNTI4NzUzCjM3LDM3LDY3LjQ5OTI3NDk2NzQ4NjcsMTE0LjEyNzU4MzEwODA2NzIKMzgsMzgsMzkuNDMxNDU0MjA1NzczNCw5MS4wNjY3NzA2NjUzOTEzCjM5LDM5LDQwLjkxMTE1NTk2NjIwNzYsNjMuMjE2OTYzODkyMDk0NQo0MCw0MCw1Ny41NjMwMDk4ODQ2Mjc5LDExMS4wMzU5MjMwODI5NTQzCjQxLDQxLDYzLjM2ODg0ODA5NzgwMTMwNSwxMDIuMTU2OTg0NDc4MTg0Mgo0Miw0Miw2MC4xOTI4MDY5NDIzMTIxLDg5Ljg3MTk4NDMyNzAxNTgKNDMsNDMsNDguNjgzNjkzNDg2OTEyNiw5Ni42NzgwOTkyMzQ3NTA4CjQ0LDQ0LDQ1LjMwMjAwMjIxMzE4ODksNzcuNzE3NzcxNTMxMTQ0Mgo0NSw0NSw2MC42MzYwOTA2MzQ4ODY5LDk5LjY4Mzk3MTMxNTE0NTcKNDYsNDYsNDkuMTg2NjY2ODAxODU0MSw3OC41OTk2NzcxNTQ5NjI0CjQ3LDQ3LDM1LjcyNDM1NzQ3OTM3MTYsNzkuMzA4MTM3ODM5ODEyMwo0OCw0OCw1Mi4yMTkyNjM5NTI3MDE0OTYsODkuODk4NDg2MDY2NjM3Ngo0OSw0OSw0NC44OTMxMjY1NTczNzM0MSwxMDMuNDczMjI2OTk0MzA4Mwo1MCw1MCw2Ni4yMDIyNzEyMTE4NzUyLDgwLjM1OTI0ODIxODIwNTAxCjUxLDUxLDY2LjM5ODIwMTI3NzEwMTYsOTkuNTQyMDA2MTA2NzYzNgo1Miw1Miw2MS4wMTU3MzE5MzMzMDg5LDEwOC42NDgxNjMxMzk2MDAyCjUzLDUzLDQ5LjExMjM2Mzc3NTIzODI5LDEwMi44OTg3NTM5ODU0NDEzCjU0LDU0LDc0LjAxNjEzNjEyNDA4OTMsMTE1LjkzMjYwNzg3MDMwMjkKNTUsNTUsNTQuMDE2MDA3MjQzOTM0Njk1LDg5LjU2MDgwNTUwNjcxNTMKNTYsNTYsNjYuMDYyODIyNDIwMDM4NSwxMDkuMDczMjYzNjAwNjcwOQo1Nyw1Nyw2NC42NTUxNzk2MjM5NjI3LDExMi40NDg1MzM5Mzk0ODI3CjU4LDU4LDM3LjQ5MTU4MzI0ODEwODEsOTMuODM4NjU5Nzc1Mjg2MQo1OSw1OSwzOS4wNjAxNjY1Mjk5MDksOTMuOTU1MDA5NjIwMzc2CjYwLDYwLDYyLjA4MjE0NTAxODUwODUsMTA2LjQzMzA1MzgxNjAwMjYKNjEsNjEsNTQuMzA2MDkzNDkzMjc1ODk1LDkzLjMxNjk2NzA1NzA5NTMKNjIsNjIsNDQuNjM1MDI1NDY5MzMxNzk0LDcyLjA3NTgyNDA3NzI3MDYKNjMsNjMsNjguMDI4ODUyNzkyNDUxNiwxMTUuODU0MjgyMDk2OTcKNjQsNjQsNDkuMzc1MTg0ODUxMDg0LDg5LjM3NzYwMjYzMTAyMzYKNjUsNjUsNDcuNTI4MTI5OTAwMjA5ODA1LDgyLjM0NzI2ODg0MDM0NTQ5CjY2LDY2LDUyLjg1NDQzMzM2OTg4NTcsOTguMTE3MzkyMDc2OTE3MQo2Nyw2Nyw0My4xOTY2NDk0OTQ0MjAxLDgyLjYxODQ5NTM0NTMwODkKNjgsNjgsNTYuMjA2MzU1NzcyMTUwNyw5MC4zNzI0OTg5MDgyODExCjY5LDY5LDUyLjQwMjY3NjgyNzE4MTY5LDc1LjIyMjQ4MTg0OTY0ODIKNzAsNzAsNDkuMDE3MzI0MDg4NTg1ODk1LDcwLjkyODMxODU0MzIyNzgKNzEsNzEsMzIuMDU1MTExNDUyMTEyMSw4MS43NDAxNTcxNDM2MTMwOQo3Miw3Miw2OS4zMTA4NjExNDQ2NTgxLDExOC4xODAwOTMyNjE0Mjk0CjczLDczLDU1LjMzMzgwNTM5NTE5OTgsOTEuMTg5OTUzNzU2MDMxNAo3NCw3NCw0MS45MjI3MDkzMTgxMzE4LDgzLjYyMDc5MjYzNjY1MTIKNzUsNzUsNjAuMDQzMjIzMTgxMjg5OSwxMTEuOTIzNTYyMzY0MTc2Mgo3Niw3NiwzMy4yMDExMTUyNzIzMzY5LDc4LjM5MTIzNDgyOTY3OTYKNzcsNzcsNDIuODM1NDgzMjUxNjIwNSwxMDUuNTU1Nzg5MTc0MjY4Ngo3OCw3OCwzOC44NTYzNTkzMDQ1OTIyLDg0LjIyNzE5MjEwODU4NjkKNzksNzksNTQuMjAxMDA0NzE5MjYwMSw5Ni44NzM3MjA5NDc4NzE3CjgwLDgwLDU4Ljk0NDYxODUzODc2NzIsODguNzg5MzU3NTM5MTc4OAo4MSw4MSw1MS40ODc1NDg5MjkzNDU0OSw5My4yMDkxODM0Nzc2NTYxCjgyLDgyLDUyLjE4MjQzNjA3NjczNDYwNCw5Mi40NDczMzY5MTIwMDM3CjgzLDgzLDQ5LjA2MTY5Nzg3ODczNjEsODEuMjA5MTM2NDg3NTk4Cjg0LDg0LDU2LjEzMjk5MzcxMTE0MzQsODEuNjU0NDMxNjcyNjE1Mgo4NSw4NSw1OS42MjA5NDU1Mzg2MywxMTAuMDE2ODAyODQzODgzNQo4Niw4NiwzOS4wOTY3MzAyNjMwMTgsNjcuMjk1ODI1ODAwOTgyOAo4Nyw4NywzNy40ODg5NzkwODY1MTMyLDczLjk3MTkwODYwMDYwMjYKODgsODgsNjQuMTUyMDcyNTQ2MTA2Nyw4OS43ODgwNDQ4MzYzNzk1Cjg5LDg5LDQ2LjYxMDg3MzA2NjE5MzgwNCw3MC41Nzk0OTg0OTM4ODY2CjkwLDkwLDY2LjI4MzQ2NjMxOTE0ODUsMTA2LjgyMzQ4MzE5NTk2NzkKOTEsOTEsNDUuMzM3NzM4OTk1MTU5Niw5MC45MTc0NzU0MzE0NzkyCjkyLDkyLDM0LjEwOTEwNDYwMzAzNzEsNjYuNjY5NzA4ODM0MTExNwo5Myw5Myw2MS4wMDQ2MTczMTcwNzU2LDEwMi44OTU0OTIyMjg0NzQKOTQsOTQsNjQuNTk4MjcyNjAyOTg2Myw5MC40NDM2MDk1NTcxNjE2Cjk1LDk1LDcyLjk3NDcyMDY4NjkzMzMsMTE2LjUxNzY3MTQyNjE4NDcKOTYsOTYsNDAuODQ2MzAzNzIxMTQwMyw4My40MzM4MDM0Nzg5Mzc3OQo5Nyw5Nyw0MC40NTI2MDIxODM0NzUxLDg3LjA0NDcyMzQwNTQ3MzIKOTgsOTgsNDIuNzk3NjE2MTc0MzM0MSw4OC41MDQwNDA0MTMxMDA1Cjk5LDk5LDU3LjcwMjAwMjE2NTkxMzMsMTA1LjMyMTk2MzE5Mzc5ODEKMTAwLDEwMCw0MS4xNDUyNjIxMTIxNDA4LDk0Ljc0ODQyODQzMzYxNTEK').then(res => res.blob()).then(blob => {
      const downloadURL = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      document.body.appendChild(a);
      a.href = downloadURL;
      a.download = 'noten2.csv'; a.click();
      window.URL.revokeObjectURL(downloadURL);
      document.body.removeChild(a);
        });"><button class="btn btn-default downloadthis  " id="dnldts45834"><i class="bi bi-download"></i> Download </button></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">noten2</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>  <span class="co"># y ist der Punktwert in der Klausur</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mw</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">91</td>
</tr></tbody>
</table>
</div>
</div>
<p>Ihre Überlegung: “Im Schnitt haben die Studis bei der letzten Klausur ungefähr 91.12 erzielt. Diesen Wert kannst du erwarten. Solange ich keine genaueren Infos habe, z.<span class="math inline">\(\,\)</span>B. wie viel du gelernt hast, kann ich dir keine genauere Vorhersage machen. Sorry!” <span class="math inline">\(\square\)</span></p>
</div>
<p>Ohne Kenntnis einer UV (Prädiktor) (wie z.<span class="math inline">\(\,\)</span>B. Lernzeit) ist der Mittelwert ein geeigneter Vorhersagewert für jede Beobachtung, s. <a href="#fig-noten3" class="quarto-xref">Abbildung&nbsp;<span>9.1</span></a>. Wir nutzen den Mittelwert als Punktmodell für den Klausurerfolg. <span class="math inline">\(\square\)</span></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-noten3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-noten3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-noten3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-noten3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.1: Mittelwert als Vorhersagewert, bzw. Mittelwert als Punktmodell
</figcaption></figure>
</div>
</div>
</div>
<div id="def-nullmodell" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.1 (Nullmodell (Punktmodell))</strong></span> Modelle ohne UV, Punktmodelle also, kann man so bezeichnen: <code>y ~ 1</code>. Da das Modell null UV hat, nennt man es auch manchmal <em>Nullmodell.</em> <span class="math inline">\(\square\)</span></p>
</div>
<p>Auf Errisch kann man dieses Nullmodell so spezifizieren:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># results: show</span></span>
<span><span class="va">lm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">noten2</span><span class="op">)</span></span>
<span><span class="va">lm0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = y ~ 1, data = noten2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)  </span></span>
<span><span class="co">##        91.1</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>lm</code> steht für “lineares Modell”, die <code>1</code> sagt, dass es keine Prädiktoren gibt. In dem Fall wird der Mittelwert, 91, als Gerade verwendet. Der zurückgemeldete Koeffizient <code>(Intercept)</code> ist in diesem Fall der einzige Koeffizient des Modells. Da es ein Punktmodell ist, sagt es für alle Beobachtungen (hier Studierenden) den gleichen Wert vorher, nämlich 91.</p>
</section><section id="vorhersagen-mit-uv" class="level3" data-number="9.2.2"><h3 data-number="9.2.2" class="anchored" data-anchor-id="vorhersagen-mit-uv">
<span class="header-section-number">9.2.2</span> Vorhersagen mit UV</h3>
<div id="exm-noten3" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.2 (Toni verrät die Lernzeit)</strong></span> Toni entschließt sich dann doch noch, die Lernzeit zu verraten: “Okay, also ich hab insgesamt 42 Stunden gelernt, insgesamt.” Jetzt müssen Sie erstmal nachdenken: “Wie viele Klausurpunkte sage ich vorher, wenn Toni 42 Stunden gelernt hat?”</p>
<p>Sie visualisieren sich zur Hilfe die vorliegenden Daten, s. <a href="#fig-noten4" class="quarto-xref">Abbildung&nbsp;<span>9.2</span></a>, (a).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://boxuancui.github.io/DataExplorer/">DataExplorer</a></span><span class="op">)</span></span>
<span><span class="va">noten2</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="http://boxuancui.github.io/DataExplorer/reference/plot_scatterplot.html">plot_scatterplot</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span>  <span class="co"># Y-Variable muss angegeben werden</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Auf dieser Basis antworten Sie Toni: “Bei 42 Stunden Lernzeit solltest du so 83 Punkte bekommen. Könnte mit dem Bestehen eng werden.” Toni ist nicht begeistert von Ihrer Prognose und zieht von dannen. <span class="math inline">\(\square\)</span></p>
</div>
<p>Der “Trend” (im Sinne eines linearen Zusammenhangs) von <em>Lernzeit</em> und <em>Klausurpunkte</em> ist deutlich zu erkennen: Je mehr Lernzeit, desto mehr Klausurpunkte. Mit einem Lineal könnte man eine entsprechende Gerade in das Streudiagramm einzeichnen, s. <a href="#fig-noten4" class="quarto-xref">Abbildung&nbsp;<span>9.2</span></a>, (b).</p>
<div id="fig-noten4" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-noten4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-noten4" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-noten4-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-noten4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-noten4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-noten4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-noten4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Streudiagramm
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-noten4" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-noten4-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-noten4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-noten4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-noten4">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-noten4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Streudigramm mit ‘Trendgerade’
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-noten4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.2: Noten und Lernzeit: Rohdaten (a) und mit Modell (b). Mittelwerte sind mit gestrichelten Linien eingezeichnet. Tonis Vorhersage ist mit einem Punkt markiert.
</figcaption></figure>
</div>
</section></section><section id="geradenmodelle" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="geradenmodelle">
<span class="header-section-number">9.3</span> Geradenmodelle</h2>
<section id="achsenabschnitt-und-steigung-definieren-eine-gerade" class="level3" data-number="9.3.1"><h3 data-number="9.3.1" class="anchored" data-anchor-id="achsenabschnitt-und-steigung-definieren-eine-gerade">
<span class="header-section-number">9.3.1</span> Achsenabschnitt und Steigung definieren eine Gerade</h3>
<p>Wir verwenden eine Gerade als Modell für die Daten, s. <a href="#fig-noten4" class="quarto-xref">Abbildung&nbsp;<span>9.2</span></a>, b. Anders gesagt: Wir modellieren die Daten (bzw. deren Zusammenhang) mit einer Geraden. Ein <em>Geradenmodell</em> ist eine Verallgemeinerung des Punktmodells: Ein Punktmodell sagt für alle Beobachtungen den gleichen Wert vorher. <a href="#fig-noten3" class="quarto-xref">Abbildung&nbsp;<span>9.1</span></a> und <a href="#fig-noten4" class="quarto-xref">Abbildung&nbsp;<span>9.2</span></a> stellen ein Punktmodell einem Geradenmodell gegenüber.</p>
<p>In einem Geradenmodell wird nicht mehr (notwendig) für jede Beobachtung die gleiche Vorhersage <span class="math inline">\(\hat{y}\)</span> gemacht (wie das bei einem Punktmodell der Fall ist).</p>
<div id="def-gerade" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.2 (Gerade)</strong></span> Eine Gerade ist das, was man bekommt, wenn man eine lineare Funktion in ein Koordinatensystem einzeichnet. Man kann sie durch durch zwei <em>Koeffizienten</em> festlegen: Achsenabschnitt (engl. <em>intercept</em>), und Steigung (engl. <em>slope</em>). <span class="math inline">\(\square\)</span></p>
</div>
<p>Manchmal wird (z.<span class="math inline">\(\,\)</span>B. im Schulunterricht) der Achsenabschnitt mit <span class="math inline">\(t\)</span> und die Steigung mit <span class="math inline">\(m\)</span> bezeichnet:</p>
<!-- HTML, PDF: -->
<p><span class="math inline">\(f(\color{xcol}{x})=\color{ycol}{y}={m} \color{xcol}{x} + \color{beta0col}{t}\)</span>.</p>
<p>In der Statistik wird folgende Nomenklatur bevorzugt: <span class="math inline">\(f(\color{xcol}{x})=\color{ycol}{\hat{y}}=\color{beta0col}{\beta_0} + \color{beta1col}{\beta_1} \color{xcol}{x}\)</span> oder <span class="math inline">\(f(\color{xcol}{x})=\color{ycol}{\hat{y}}= \color{beta0col}{b_0} + \color{beta1col}{b_1} \color{xcol}{x}\)</span> .</p>
<p>Die Nomenklatur mit <span class="math inline">\(\color{beta0col}{b_0}, \color{beta1col}{b_1}\)</span> hat den Vorteil, dass man das Modell einfach erweitern kann: <span class="math inline">\(b_2, b_3, \ldots\)</span>. Anstelle von <span class="math inline">\(b\)</span> liest man auch oft <span class="math inline">\(\beta\)</span>. Griechische Buchstaben werden meist verwendet, um zu zeigen, dass man an einer Aussage über eine Population, nicht nur über eine Stichprobe, machen möchte.</p>
<p>Das “Dach” über y, <span class="math inline">\(\color{modelcol}{\hat{y}}\)</span> (sprich: “y-Dach”), drückt aus, dass es sich den den geschätzten, bzw. vom Modell vorhergesagten (“modellierten”) Wert für <span class="math inline">\(\color{ycol}{y}\)</span> handelt, nicht der tatsächliche (empirische, beobachtete) Wert von <span class="math inline">\(\color{ycol}{y}\)</span>. <a href="#fig-regrtex" class="quarto-xref">Abbildung&nbsp;<span>9.3</span></a> skizziert die Elemente einer Regression.</p>
<div id="fig-regrtex" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-regrtex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/regr.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-regrtex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.3: Achsenabschnitt (<span class="math inline">\(\beta_0\)</span>) und Steigung (<span class="math inline">\(\beta_1\)</span>) einer Regressionsgeraden <span class="citation" data-cites="menk_linear_2014">(<a href="references.html#ref-menk_linear_2014" role="doc-biblioref">Menk, 2014</a>)</span>
</figcaption></figure>
</div>
<!-- HTML, PDF -->
<div id="def-einfache-lineare-modell" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.3 (Das einfache lineare Modell)</strong></span> Das einfache lineare Modell beschreibt den Wert einer abhängigen metrischen Variablen, <span class="math inline">\(\color{ycol}{y}\)</span>, als lineare Funktion von einer (oder mehreren) unabhängigen Variablen, <span class="math inline">\(\color{xcol}{x}\)</span>, plus einem Fehlerterm, <span class="math inline">\(\color{errorcol}{e}\)</span> bzw. <span class="math inline">\(\color{errorcol}{\epsilon}\)</span>, s. <a href="#eq-linear-model" class="quarto-xref">Gleichung&nbsp;<span>9.1</span></a>. <span class="math inline">\(\square\)</span></p>
</div>
<p><span id="eq-linear-model"><span class="math display">\[\begin{aligned}
\color{ycol}{y} &amp;= f(\color{xcol}{x}) + \color{errorcol}{\epsilon} \\
\color{ycol}{y_i} &amp;= \color{beta0col}{\beta_0} + \color{beta1col}{\beta_1} \cdot \color{modelcol}{x_i} + \color{errorcol}{\epsilon_i} \square
\end{aligned} \tag{9.1}\]</span></span></p>
<p>Die Variablen in <a href="#eq-linear-model" class="quarto-xref">Gleichung&nbsp;<span>9.1</span></a> haben folgende Bedeutung:</p>
<ul>
<li>
<span class="math inline">\(\color{beta0col}{\beta_0}\)</span>: geschätzter y-Achsenabschnitt laut Modell (engl. <em>intercept</em>)</li>
<li>
<span class="math inline">\(\color{beta1col}{\beta_1}\)</span>: geschätzte Steigung (Regressionsgewicht) laut Modell (engl. <em>slope</em>)</li>
<li>
<span class="math inline">\(\color{errorcol}{\epsilon}\)</span>: Fehler des Modells</li>
</ul>
<p>In <a href="#eq-linear-model" class="quarto-xref">Gleichung&nbsp;<span>9.1</span></a> schreiben wir <span class="math inline">\(\color{ycol}{y}\)</span> und nicht <span class="math inline">\(\color{modelcol}{\hat{y}}\)</span>, weil wir den tatsächlichen, beobachteten Wert von <span class="math inline">\(\color{ycol}{y}\)</span> als Summe von vorhergesagtem Wert, <span class="math inline">\(\color{modelcol}{\hat{y}}\)</span> und Modellfehler, <span class="math inline">\(\color{errorcol}{\epsilon}\)</span> beschreiben.</p>
<p>Je nach Datenlage können sich Regressionsgeraden in Steigung oder Achsenabschnitt unterscheiden, s. <a href="#fig-regr-div" class="quarto-xref">Abbildung&nbsp;<span>9.4</span></a>.</p>
<div id="fig-regr-div" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-regr-div-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-regr-div" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-regr-div-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-regr-div-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-regr-div-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-regr-div">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-regr-div-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Datensatz 1
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-regr-div" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-regr-div-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-regr-div-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-regr-div-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-regr-div">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-regr-div-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Datensatz 2
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-regr-div-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.4: Regressionsanalysen mit verschiedenen Koeffizienten, aber gleicher Modellgüte
</figcaption></figure>
</div>
<p><a href="#fig-linfun" class="quarto-xref">Abbildung&nbsp;<span>9.5</span></a> zeigt ein interaktives Beispiel einer linearen Funktion. Sie können Punkte per Klick/Touch hinzufügen.</p>
<div id="fig-linfun" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-linfun-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="figure-content">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb6-0"><a href="#cb6-0" aria-hidden="true" tabindex="-1"></a>resetButton <span class="op">=</span> {</span>
<span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> resetButton <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Reset"</span>)<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(resetButton)<span class="op">.</span><span class="fu">on</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    regressionPlot<span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> resetButton<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb7-0"><a href="#cb7-0" aria-hidden="true" tabindex="-1"></a>viewOptions <span class="op">=</span> {</span>
<span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> viewOptions <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"None"</span><span class="op">,</span> <span class="st">"Absolute Error"</span><span class="op">,</span> <span class="st">"Squared Error"</span>]<span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">label</span><span class="op">:</span> <span class="st">"View"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"Absolute Error"</span> }</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(viewOptions)<span class="op">.</span><span class="fu">on</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    regressionPlot<span class="op">.</span><span class="fu">updateView</span>(viewOptions<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> viewOptions<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb8-0"><a href="#cb8-0" aria-hidden="true" tabindex="-1"></a>rSquaredPlot <span class="op">=</span> <span class="fu">RSquaredPlot</span>({ <span class="dt">width</span><span class="op">:</span> width })</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb9-0"><a href="#cb9-0" aria-hidden="true" tabindex="-1"></a>regressionPlot <span class="op">=</span> {</span>
<span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regressionPlot <span class="op">=</span> <span class="fu">RegressionPlot</span>(data<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">xDomain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> ([x]) <span class="kw">=&gt;</span> x) <span class="op">+</span> <span class="dv">5</span>]<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yDomain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> ([_<span class="op">,</span> y]) <span class="kw">=&gt;</span> y) <span class="op">+</span> <span class="dv">5</span>]<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">r</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showGrid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Attach listener</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(regressionPlot)<span class="op">.</span><span class="fu">on</span>(<span class="st">"input"</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    rSquaredPlot<span class="op">.</span><span class="fu">update</span>(<span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">transition</span>)<span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  rSquaredPlot<span class="op">.</span><span class="fu">update</span>(regressionPlot<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> regressionPlot<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="1" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">800</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> numPoints <span class="op">=</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xShift <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yShift <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(numPoints)<span class="op">.</span><span class="fu">map</span>((i) <span class="kw">=&gt;</span> {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xCoord <span class="op">=</span> xShift <span class="op">+</span> xScale <span class="op">*</span> d3<span class="op">.</span><span class="fu">randomUniform</span>()()<span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yCoord <span class="op">=</span> yShift <span class="op">+</span> xCoord <span class="op">+</span> yScale <span class="op">*</span> d3<span class="op">.</span><span class="fu">randomUniform</span>()()<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [xCoord<span class="op">,</span> yCoord]<span class="op">;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb11-0"><a href="#cb11-0" aria-hidden="true" tabindex="-1"></a>animation <span class="op">=</span> {</span>
<span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Perform opening animation</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalTime <span class="op">=</span> <span class="dv">6_000</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ease <span class="op">=</span> d3<span class="op">.</span><span class="at">easeQuadOut</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">1</span><span class="op">,</span> data<span class="op">.</span><span class="at">length</span>)<span class="op">.</span><span class="fu">forEach</span>((i) <span class="kw">=&gt;</span> {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> [xCoord<span class="op">,</span> yCoord] <span class="op">=</span> data[i]<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      regressionPlot<span class="op">.</span><span class="fu">updateDatapoint</span>(xCoord<span class="op">,</span> yCoord)<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> totalTime <span class="op">*</span> <span class="fu">ease</span>(i <span class="op">/</span> data<span class="op">.</span><span class="at">length</span>))<span class="op">;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb12-0"><a href="#cb12-0" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">RSquaredPlot</span>({</span>
<span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>  data<span class="op">,</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  marginTop <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// top margin, in pixels</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  marginRight <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="co">// right margin, in pixels</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  marginBottom <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// bottom margin, in pixels</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  marginLeft <span class="op">=</span> <span class="dv">53</span><span class="op">,</span> <span class="co">// left margin, in pixels</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  width <span class="op">=</span> <span class="dv">640</span><span class="op">,</span> <span class="co">// outer width, in pixels</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  height <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> <span class="co">// outer height, in pixels</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  barHeight <span class="op">=</span> <span class="dv">25</span><span class="op">,</span> <span class="co">// height of bar, in pixels</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  titleSize <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> <span class="co">// fontsize of title text</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  labelSize <span class="op">=</span> <span class="dv">12</span> <span class="co">// fontsize of label text</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data <span class="op">===</span> <span class="kw">undefined</span>) data <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([marginLeft<span class="op">,</span> width <span class="op">-</span> marginRight])<span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)<span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw title.</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> titleGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// titleGroup</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .append("line")</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("stroke", "black")</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("x1", xScale(0))</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("x2", xScale(0))</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("y1", 0)</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("y2", height);</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  titleGroup</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"serif"</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> titleSize)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"R²"</span>)<span class="op">;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw whole bar.</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"gainsboro"</span>)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> marginTop)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">-</span> marginLeft <span class="op">-</span> marginRight)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">-</span> marginTop <span class="op">-</span> marginBottom)<span class="op">;</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw bar.</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bar <span class="op">=</span> <span class="fu">updateBar</span>(svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect"</span>)<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw label</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelFormat <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2f"</span>)<span class="op">;</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> label <span class="op">=</span> <span class="fu">updateLabel</span>(svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update according to data.</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(data)<span class="op">;</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateBar</span>(rect<span class="op">,</span> data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rect<span class="op">.</span><span class="fu">data</span>([data])<span class="op">.</span><span class="fu">join</span>(</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>      (enter) <span class="kw">=&gt;</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>        enter</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> marginTop)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">-</span> marginTop <span class="op">-</span> marginBottom)<span class="op">,</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>      (update) <span class="kw">=&gt;</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>        update<span class="op">.</span><span class="fu">call</span>((update) <span class="kw">=&gt;</span> {</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (transition) update <span class="op">=</span> update<span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>          update<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(<span class="pp">isNaN</span>(d) <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> d) <span class="op">-</span> <span class="fu">xScale</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateLabel</span>(text<span class="op">,</span> data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text<span class="op">.</span><span class="fu">data</span>([data])<span class="op">.</span><span class="fu">join</span>(</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>      (enter) <span class="kw">=&gt;</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>        enter</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> labelSize)</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">text</span>(<span class="fu">labelFormat</span>(<span class="st">"0"</span>))<span class="op">,</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>      (update) <span class="kw">=&gt;</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>        update<span class="op">.</span><span class="fu">call</span>((update) <span class="kw">=&gt;</span> {</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Check if bar is too short</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> check <span class="op">=</span> (d) <span class="kw">=&gt;</span> d <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">;</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (transition) update <span class="op">=</span> update<span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>          update</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d))</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> <span class="fu">labelFormat</span>(d))</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (<span class="fu">check</span>(d) <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span>))</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (<span class="fu">check</span>(d) <span class="op">?</span> <span class="st">"start"</span> <span class="op">:</span> <span class="st">"end"</span>))</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> (<span class="fu">check</span>(d) <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="op">-</span><span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Main function for data updates.</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>(data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateBar</span>(bar<span class="op">,</span> data<span class="op">,</span> transition)<span class="op">;</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateLabel</span>(label<span class="op">,</span> data<span class="op">,</span> transition)<span class="op">;</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(svg<span class="op">.</span><span class="fu">node</span>()<span class="op">,</span> { update })<span class="op">;</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb13-0"><a href="#cb13-0" aria-hidden="true" tabindex="-1"></a><span class="co">// to draw lines at the origin (to show intercept and stuff)</span></span>
<span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// create voronoi overlay? for dragging points</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">// viz error / squared error</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">// make the error lines look like a weight</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">// show other metrics like R^2 etc.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">RegressionPlot</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  data<span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> ([x]) <span class="kw">=&gt;</span> x<span class="op">,</span> <span class="co">// accessor function for x-coordinate</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ([<span class="op">,</span> y]) <span class="kw">=&gt;</span> y<span class="op">,</span> <span class="co">// accessor function for y-coordinate</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="dv">6</span><span class="op">,</span> <span class="co">// radius of dots, in pixels</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    marginTop <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> <span class="co">// top margin, in pixels</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    marginRight <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="co">// right margin, in pixels</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    marginBottom <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="co">// bottom margin, in pixels</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    marginLeft <span class="op">=</span> <span class="dv">40</span><span class="op">,</span> <span class="co">// left margin, in pixels</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    inset <span class="op">=</span> r <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// inset the default range, in pixels</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    insetTop <span class="op">=</span> inset<span class="op">,</span> <span class="co">// inset the default y-range</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    insetRight <span class="op">=</span> inset<span class="op">,</span> <span class="co">// inset the default x-range</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    insetBottom <span class="op">=</span> inset<span class="op">,</span> <span class="co">// inset the default y-range</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    insetLeft <span class="op">=</span> inset<span class="op">,</span> <span class="co">// inset the default x-range</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="dv">640</span><span class="op">,</span> <span class="co">// outer width, in pixels</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> <span class="dv">500</span><span class="op">,</span> <span class="co">// outer height, in pixels</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    xType <span class="op">=</span> d3<span class="op">.</span><span class="at">scaleLinear</span><span class="op">,</span> <span class="co">// type of x-scale</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    xDomain<span class="op">,</span> <span class="co">// [xmin, xmax]</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    xRange <span class="op">=</span> [marginLeft <span class="op">+</span> insetLeft<span class="op">,</span> width <span class="op">-</span> marginRight <span class="op">-</span> insetRight]<span class="op">,</span> <span class="co">// [left, right]</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    yType <span class="op">=</span> d3<span class="op">.</span><span class="at">scaleLinear</span><span class="op">,</span> <span class="co">// type of y-scale</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    yDomain<span class="op">,</span> <span class="co">// [ymin, ymax]</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    yRange <span class="op">=</span> [height <span class="op">-</span> marginBottom <span class="op">-</span> insetBottom<span class="op">,</span> marginTop <span class="op">+</span> insetTop]<span class="op">,</span> <span class="co">// [bottom, top]</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    showGrid <span class="op">=</span> <span class="kw">true</span> <span class="co">// whether to show grid lines</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> {}</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> errorColor <span class="op">=</span> d3<span class="op">.</span><span class="at">schemeSet3</span>[<span class="dv">3</span>]<span class="op">;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> errorLinesOpacity <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> errorSquaresOpacity <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Init drag object.</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> drag <span class="op">=</span> d3</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// .on("start", dragstarted)</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)<span class="op">;</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .on("end", dragended);</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// To give each data point a unique id</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> idCounter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute data values.</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">xCoord</span><span class="op">:</span> <span class="fu">x</span>(d)<span class="op">,</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yCoord</span><span class="op">:</span> <span class="fu">y</span>(d)<span class="op">,</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> idCounter<span class="op">++</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Store copy of initial data object</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> initData <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute default domains.</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">// if (xDomain === undefined) xDomain = d3.extent(data, (d) =&gt; d.xCoord);</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (xDomain <span class="op">===</span> <span class="kw">undefined</span>) xDomain <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">xCoord</span>)]<span class="op">;</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yDomain <span class="op">===</span> <span class="kw">undefined</span>) yDomain <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(data<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">yCoord</span>)]<span class="op">;</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Init linear regressor.</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> linearRegression <span class="op">=</span> d3</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regressionLinear</span>()</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">x</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">xCoord</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">y</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">yCoord</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(xDomain)<span class="op">;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Construct scales and axes.</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> <span class="fu">xType</span>(xDomain<span class="op">,</span> xRange)<span class="op">;</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> <span class="fu">yType</span>(yDomain<span class="op">,</span> yRange)<span class="op">;</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(xScale)<span class="op">.</span><span class="fu">ticks</span>(width <span class="op">/</span> <span class="dv">80</span>)<span class="op">;</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(yScale)<span class="op">.</span><span class="fu">ticks</span>(height <span class="op">/</span> <span class="dv">80</span>)<span class="op">;</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw svg.</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)<span class="op">;</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw xAxis.</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisOpacity <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xGroup <span class="op">=</span> svg</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span>height <span class="op">-</span> marginBottom<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> axisOpacity)</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())<span class="op">;</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw grid lines</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>  xGroup</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>()</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> marginTop <span class="op">+</span> marginBottom <span class="op">-</span> height)</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw line at origin</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> axisOpacity<span class="op">;</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> showGrid <span class="op">?</span> <span class="fl">0.1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw yAxis.</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yGroup <span class="op">=</span> svg</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>marginLeft<span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> axisOpacity)</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())<span class="op">;</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  yGroup</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clone</span>()</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> width <span class="op">-</span> marginLeft <span class="op">-</span> marginRight)</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw line at origin</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> axisOpacity<span class="op">;</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> showGrid <span class="op">?</span> <span class="fl">0.1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw error squares.</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> errorSquares <span class="op">=</span> <span class="fu">updateErrorSquares</span>(</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect"</span>)<span class="op">,</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw error lines.</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> errorLines <span class="op">=</span> <span class="fu">updateErrorLines</span>(svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw regression line.</span></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regressionLineGroup <span class="op">=</span> svg</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .attr("stroke-dasharray", "20,20");</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regressionLine <span class="op">=</span> <span class="fu">updateRegressionLine</span>(</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>    regressionLineGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)<span class="op">,</span></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw space for plot interactions.</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plotRect <span class="op">=</span> svg</span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> addDatapoint)<span class="op">;</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw data points.</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> circlesGroup <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> circles <span class="op">=</span> <span class="fu">updateCircles</span>(circlesGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Drag interactions for circles.</span></span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">raise</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update data point, as well as its position on the plot</span></span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">xCoord</span> <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(<span class="bu">event</span><span class="op">.</span><span class="at">x</span>)<span class="op">;</span></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">yCoord</span> <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(<span class="bu">event</span><span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateRegressionLine</span>(regressionLine<span class="op">,</span> data<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>    errorSquares <span class="op">=</span> <span class="fu">updateErrorSquares</span>(errorSquares<span class="op">,</span> data<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>    errorLines <span class="op">=</span> <span class="fu">updateErrorLines</span>(errorLines<span class="op">,</span> data<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span><span class="op">,</span> i) {</span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Click interaction for circles.</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">removeDatapoint</span>(<span class="bu">event</span><span class="op">,</span> dCurr) {</span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">defaultPrevented</span>) <span class="cf">return</span><span class="op">;</span> <span class="co">// dragged</span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove data point; faster way to do this?</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">!==</span> dCurr<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(data)<span class="op">;</span></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Click interaction for plot.</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">addDatapoint</span>(<span class="bu">event</span>) {</span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [xm<span class="op">,</span> ym] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(<span class="bu">event</span>)<span class="op">;</span></span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateDatapoint</span>(xScale<span class="op">.</span><span class="fu">invert</span>(xm)<span class="op">,</span> yScale<span class="op">.</span><span class="fu">invert</span>(ym))<span class="op">;</span></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function for regression line update.</span></span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateRegressionLine</span>(line<span class="op">,</span> data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> regressionData <span class="op">=</span> <span class="fu">linearRegression</span>(data)<span class="op">;</span></span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Dispatch event and R^2 value</span></span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> regressionData<span class="op">.</span><span class="at">rSquared</span><span class="op">;</span></span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">transition</span> <span class="op">=</span> transition<span class="op">;</span></span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">dispatch</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> line</span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>([regressionData])</span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"line"</span>)</span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>((line) <span class="kw">=&gt;</span> {</span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (transition) line <span class="op">=</span> line<span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true" tabindex="-1"></a>        line</span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d[<span class="dv">1</span>][<span class="dv">0</span>]))</span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d[<span class="dv">0</span>][<span class="dv">1</span>]))</span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d[<span class="dv">1</span>][<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-220"><a href="#cb13-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-221"><a href="#cb13-221" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function to update circles based on new data.</span></span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateCircles</span>(circles<span class="op">,</span> data) {</span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> circles</span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(data<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(</span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true" tabindex="-1"></a>        (enter) <span class="kw">=&gt;</span></span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true" tabindex="-1"></a>          enter</span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true" tabindex="-1"></a>            <span class="co">// To transition from 0 radius</span></span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Attach interactions</span></span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> removeDatapoint)</span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add transition</span></span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>((enter) <span class="kw">=&gt;</span></span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true" tabindex="-1"></a>              enter</span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-240"><a href="#cb13-240" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeBackOut</span><span class="op">.</span><span class="fu">overshoot</span>(<span class="fl">1.7</span>))</span>
<span id="cb13-241"><a href="#cb13-241" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> r)</span>
<span id="cb13-242"><a href="#cb13-242" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb13-243"><a href="#cb13-243" aria-hidden="true" tabindex="-1"></a>        (update) <span class="kw">=&gt;</span></span>
<span id="cb13-244"><a href="#cb13-244" aria-hidden="true" tabindex="-1"></a>          update</span>
<span id="cb13-245"><a href="#cb13-245" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-246"><a href="#cb13-246" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-247"><a href="#cb13-247" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))<span class="op">,</span></span>
<span id="cb13-248"><a href="#cb13-248" aria-hidden="true" tabindex="-1"></a>        (exit) <span class="kw">=&gt;</span></span>
<span id="cb13-249"><a href="#cb13-249" aria-hidden="true" tabindex="-1"></a>          exit</span>
<span id="cb13-250"><a href="#cb13-250" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-251"><a href="#cb13-251" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeBackIn</span><span class="op">.</span><span class="fu">overshoot</span>(<span class="fl">1.7</span>))</span>
<span id="cb13-252"><a href="#cb13-252" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-253"><a href="#cb13-253" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb13-254"><a href="#cb13-254" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb13-255"><a href="#cb13-255" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-256"><a href="#cb13-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-257"><a href="#cb13-257" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function to update error lines based on new data.</span></span>
<span id="cb13-258"><a href="#cb13-258" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateErrorLines</span>(lines<span class="op">,</span> data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb13-259"><a href="#cb13-259" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> regressionData <span class="op">=</span> <span class="fu">linearRegression</span>(data)<span class="op">;</span></span>
<span id="cb13-260"><a href="#cb13-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-261"><a href="#cb13-261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lines</span>
<span id="cb13-262"><a href="#cb13-262" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(data<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb13-263"><a href="#cb13-263" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(</span>
<span id="cb13-264"><a href="#cb13-264" aria-hidden="true" tabindex="-1"></a>        (enter) <span class="kw">=&gt;</span></span>
<span id="cb13-265"><a href="#cb13-265" aria-hidden="true" tabindex="-1"></a>          enter</span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> errorColor)</span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> errorLinesOpacity)</span>
<span id="cb13-270"><a href="#cb13-270" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Start at data point</span></span>
<span id="cb13-271"><a href="#cb13-271" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add transition</span></span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>((enter) <span class="kw">=&gt;</span></span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true" tabindex="-1"></a>              enter</span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(regressionData<span class="op">.</span><span class="fu">predict</span>(d<span class="op">.</span><span class="at">xCoord</span>)))</span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true" tabindex="-1"></a>            )<span class="op">,</span></span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true" tabindex="-1"></a>        (update) <span class="kw">=&gt;</span></span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true" tabindex="-1"></a>          update<span class="op">.</span><span class="fu">call</span>((update) <span class="kw">=&gt;</span> {</span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (transition) update <span class="op">=</span> update<span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true" tabindex="-1"></a>            update</span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(regressionData<span class="op">.</span><span class="fu">predict</span>(d<span class="op">.</span><span class="at">xCoord</span>)))<span class="op">;</span></span>
<span id="cb13-289"><a href="#cb13-289" aria-hidden="true" tabindex="-1"></a>          })<span class="op">,</span></span>
<span id="cb13-290"><a href="#cb13-290" aria-hidden="true" tabindex="-1"></a>        (exit) <span class="kw">=&gt;</span></span>
<span id="cb13-291"><a href="#cb13-291" aria-hidden="true" tabindex="-1"></a>          exit</span>
<span id="cb13-292"><a href="#cb13-292" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-293"><a href="#cb13-293" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-294"><a href="#cb13-294" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function to update error squares based on new data.</span></span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateErrorSquares</span>(rects<span class="op">,</span> data<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb13-300"><a href="#cb13-300" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> regressionData <span class="op">=</span> <span class="fu">linearRegression</span>(data)<span class="op">;</span></span>
<span id="cb13-301"><a href="#cb13-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> computeHeight <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> yCoordPred <span class="op">=</span> regressionData<span class="op">.</span><span class="fu">predict</span>(d<span class="op">.</span><span class="at">xCoord</span>)<span class="op">;</span></span>
<span id="cb13-304"><a href="#cb13-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-305"><a href="#cb13-305" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="fu">yScale</span>(yCoordPred) <span class="op">-</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))<span class="op">;</span></span>
<span id="cb13-306"><a href="#cb13-306" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb13-307"><a href="#cb13-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compute which direction the box should face</span></span>
<span id="cb13-308"><a href="#cb13-308" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> computeTransform <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb13-309"><a href="#cb13-309" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> yCoordPred <span class="op">=</span> regressionData<span class="op">.</span><span class="fu">predict</span>(d<span class="op">.</span><span class="at">xCoord</span>)<span class="op">;</span></span>
<span id="cb13-310"><a href="#cb13-310" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> check <span class="op">=</span> <span class="fu">yScale</span>(yCoordPred) <span class="op">-</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>) <span class="op">&lt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-311"><a href="#cb13-311" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> deg <span class="op">=</span> check <span class="op">?</span> <span class="op">-</span><span class="dv">90</span> <span class="op">:</span> <span class="dv">90</span><span class="op">;</span></span>
<span id="cb13-312"><a href="#cb13-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-313"><a href="#cb13-313" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`rotate(</span><span class="sc">${</span>deg<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>)<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb13-314"><a href="#cb13-314" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb13-315"><a href="#cb13-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-316"><a href="#cb13-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rects</span>
<span id="cb13-317"><a href="#cb13-317" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(data<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb13-318"><a href="#cb13-318" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(</span>
<span id="cb13-319"><a href="#cb13-319" aria-hidden="true" tabindex="-1"></a>        (enter) <span class="kw">=&gt;</span></span>
<span id="cb13-320"><a href="#cb13-320" aria-hidden="true" tabindex="-1"></a>          enter</span>
<span id="cb13-321"><a href="#cb13-321" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb13-322"><a href="#cb13-322" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb13-323"><a href="#cb13-323" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> errorColor)</span>
<span id="cb13-324"><a href="#cb13-324" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> errorSquaresOpacity)</span>
<span id="cb13-325"><a href="#cb13-325" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> computeTransform)</span>
<span id="cb13-326"><a href="#cb13-326" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Start at data point</span></span>
<span id="cb13-327"><a href="#cb13-327" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-328"><a href="#cb13-328" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-329"><a href="#cb13-329" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-330"><a href="#cb13-330" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-331"><a href="#cb13-331" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Add transition</span></span>
<span id="cb13-332"><a href="#cb13-332" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">call</span>((enter) <span class="kw">=&gt;</span> {</span>
<span id="cb13-333"><a href="#cb13-333" aria-hidden="true" tabindex="-1"></a>              enter</span>
<span id="cb13-334"><a href="#cb13-334" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb13-335"><a href="#cb13-335" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> computeHeight)</span>
<span id="cb13-336"><a href="#cb13-336" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> computeHeight)<span class="op">;</span></span>
<span id="cb13-337"><a href="#cb13-337" aria-hidden="true" tabindex="-1"></a>            })<span class="op">,</span></span>
<span id="cb13-338"><a href="#cb13-338" aria-hidden="true" tabindex="-1"></a>        (update) <span class="kw">=&gt;</span></span>
<span id="cb13-339"><a href="#cb13-339" aria-hidden="true" tabindex="-1"></a>          update<span class="op">.</span><span class="fu">call</span>((update) <span class="kw">=&gt;</span> {</span>
<span id="cb13-340"><a href="#cb13-340" aria-hidden="true" tabindex="-1"></a>            update<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> computeTransform)<span class="op">;</span></span>
<span id="cb13-341"><a href="#cb13-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-342"><a href="#cb13-342" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (transition) update <span class="op">=</span> update<span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb13-343"><a href="#cb13-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-344"><a href="#cb13-344" aria-hidden="true" tabindex="-1"></a>            update</span>
<span id="cb13-345"><a href="#cb13-345" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">xScale</span>(d<span class="op">.</span><span class="at">xCoord</span>))</span>
<span id="cb13-346"><a href="#cb13-346" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">yScale</span>(d<span class="op">.</span><span class="at">yCoord</span>))</span>
<span id="cb13-347"><a href="#cb13-347" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> computeHeight)</span>
<span id="cb13-348"><a href="#cb13-348" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> computeHeight)<span class="op">;</span></span>
<span id="cb13-349"><a href="#cb13-349" aria-hidden="true" tabindex="-1"></a>          })<span class="op">,</span></span>
<span id="cb13-350"><a href="#cb13-350" aria-hidden="true" tabindex="-1"></a>        (exit) <span class="kw">=&gt;</span> exit<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb13-351"><a href="#cb13-351" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb13-352"><a href="#cb13-352" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-353"><a href="#cb13-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-354"><a href="#cb13-354" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Resets the plot to the initial data</span></span>
<span id="cb13-355"><a href="#cb13-355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">reset</span>() {</span>
<span id="cb13-356"><a href="#cb13-356" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(initData<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb13-357"><a href="#cb13-357" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-358"><a href="#cb13-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-359"><a href="#cb13-359" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Updates which error type to show</span></span>
<span id="cb13-360"><a href="#cb13-360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateView</span>(option) {</span>
<span id="cb13-361"><a href="#cb13-361" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (option <span class="op">===</span> <span class="st">"None"</span>) {</span>
<span id="cb13-362"><a href="#cb13-362" aria-hidden="true" tabindex="-1"></a>      errorLinesOpacity <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-363"><a href="#cb13-363" aria-hidden="true" tabindex="-1"></a>      errorSquaresOpacity <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-364"><a href="#cb13-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-365"><a href="#cb13-365" aria-hidden="true" tabindex="-1"></a>      errorLines<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-366"><a href="#cb13-366" aria-hidden="true" tabindex="-1"></a>      errorSquares<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-367"><a href="#cb13-367" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (option <span class="op">===</span> <span class="st">"Absolute Error"</span>) {</span>
<span id="cb13-368"><a href="#cb13-368" aria-hidden="true" tabindex="-1"></a>      errorLinesOpacity <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb13-369"><a href="#cb13-369" aria-hidden="true" tabindex="-1"></a>      errorSquaresOpacity <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-370"><a href="#cb13-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-371"><a href="#cb13-371" aria-hidden="true" tabindex="-1"></a>      errorLines<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb13-372"><a href="#cb13-372" aria-hidden="true" tabindex="-1"></a>      errorSquares<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-373"><a href="#cb13-373" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (option <span class="op">===</span> <span class="st">"Squared Error"</span>) {</span>
<span id="cb13-374"><a href="#cb13-374" aria-hidden="true" tabindex="-1"></a>      errorLinesOpacity <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-375"><a href="#cb13-375" aria-hidden="true" tabindex="-1"></a>      errorSquaresOpacity <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb13-376"><a href="#cb13-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-377"><a href="#cb13-377" aria-hidden="true" tabindex="-1"></a>      errorLines<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-378"><a href="#cb13-378" aria-hidden="true" tabindex="-1"></a>      errorSquares<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb13-379"><a href="#cb13-379" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-380"><a href="#cb13-380" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-381"><a href="#cb13-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-382"><a href="#cb13-382" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Adds a new datapoint and updates the plot</span></span>
<span id="cb13-383"><a href="#cb13-383" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateDatapoint</span>(xCoord<span class="op">,</span> yCoord) {</span>
<span id="cb13-384"><a href="#cb13-384" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add datapoint</span></span>
<span id="cb13-385"><a href="#cb13-385" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> [<span class="op">...</span>data<span class="op">,</span> { xCoord<span class="op">,</span> yCoord<span class="op">,</span> <span class="dt">id</span><span class="op">:</span> idCounter<span class="op">++</span> }]<span class="op">;</span></span>
<span id="cb13-386"><a href="#cb13-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-387"><a href="#cb13-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(data)<span class="op">;</span></span>
<span id="cb13-388"><a href="#cb13-388" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-389"><a href="#cb13-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-390"><a href="#cb13-390" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Main function that updates the plot based on new data</span></span>
<span id="cb13-391"><a href="#cb13-391" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">update</span>(newData<span class="op">,</span> transition <span class="op">=</span> <span class="kw">true</span>) {</span>
<span id="cb13-392"><a href="#cb13-392" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Upate local data object</span></span>
<span id="cb13-393"><a href="#cb13-393" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> newData<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb13-394"><a href="#cb13-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-395"><a href="#cb13-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateRegressionLine</span>(regressionLine<span class="op">,</span> data<span class="op">,</span> transition)<span class="op">;</span></span>
<span id="cb13-396"><a href="#cb13-396" aria-hidden="true" tabindex="-1"></a>    circles <span class="op">=</span> <span class="fu">updateCircles</span>(circles<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb13-397"><a href="#cb13-397" aria-hidden="true" tabindex="-1"></a>    errorSquares <span class="op">=</span> <span class="fu">updateErrorSquares</span>(errorSquares<span class="op">,</span> data<span class="op">,</span> transition)<span class="op">;</span></span>
<span id="cb13-398"><a href="#cb13-398" aria-hidden="true" tabindex="-1"></a>    errorLines <span class="op">=</span> <span class="fu">updateErrorLines</span>(errorLines<span class="op">,</span> data<span class="op">,</span> transition)<span class="op">;</span></span>
<span id="cb13-399"><a href="#cb13-399" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-400"><a href="#cb13-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-401"><a href="#cb13-401" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(svg<span class="op">.</span><span class="fu">node</span>()<span class="op">,</span> {</span>
<span id="cb13-402"><a href="#cb13-402" aria-hidden="true" tabindex="-1"></a>    update<span class="op">,</span></span>
<span id="cb13-403"><a href="#cb13-403" aria-hidden="true" tabindex="-1"></a>    updateDatapoint<span class="op">,</span></span>
<span id="cb13-404"><a href="#cb13-404" aria-hidden="true" tabindex="-1"></a>    updateView<span class="op">,</span></span>
<span id="cb13-405"><a href="#cb13-405" aria-hidden="true" tabindex="-1"></a>    reset</span>
<span id="cb13-406"><a href="#cb13-406" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-407"><a href="#cb13-407" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="0" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line -1;"><span id="cb14-0"><a href="#cb14-0" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-regression"</span><span class="op">,</span> <span class="st">"d3"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-linfun-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.5: Interaktives Beispiel für eines lineares Modell. Fügen Sie Punkte per Klick/Touch hinzu.
</figcaption></figure>
</div>
<div id="exm-noten5" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.3 (Toni will es genau wissen)</strong></span> Da Toni Sie als Statistik-Profi abgespeichert hat, werden Sie wieder konsultiert: “Okay, ich hab noch zwei Fragen. Erstens: Wie viele Punkte bekomme ich, wenn ich gar nicht lerne? Zweitens, wie viele Punkte bekomme ich pro gelernte Stunde? Ist immerhin meine Lebenszeit, krieg ich nicht zurück!” <span>Das sind gute Fragen. Den <span class="math inline">\(\color{ycol}{Y}\)</span>-Wert (Klausurpunkte) bei <span class="math inline">\(\color{xcol}{x}=0\)</span> gibt der Achsenabschnitt zurück.</span> Schnell skizzieren Sie dazu ein Diagramm, s. <a href="#fig-beta0" class="quarto-xref">Abbildung&nbsp;<span>9.6</span></a>. Puh, die Antwort wird Toni nicht gefallen … <span class="math inline">\(\square\)</span></p>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-beta0" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-beta0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-beta0-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-beta0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.6: Der Achsenabschnitt: Wie viele Punkte kann Toni erwarten bei 0 Lernstunden? (roter Punkt bei x=0)
</figcaption></figure>
</div>
</div>
</div>
<p>Anstelle auf <a href="#fig-beta0" class="quarto-xref">Abbildung&nbsp;<span>9.6</span></a> zu schauen, können Sie sich auch von R Tonis Klausurerfolg vorhersagen (to predict) lassen:</p>
<blockquote class="blockquote">
<p><span>🧑‍🏫</span> Hey R, predicte mir mal auf Basis vom Modell “lm_toni” den Lernerfolg für Toni, wenn der x=0 Stunden lernt.</p>
</blockquote>
<blockquote class="blockquote">
<p><span>🤖</span> Okay, ich predicte mit Modell “lm_toni” und nehme als neue Datentabelle Tonis Lernzeit (x=0)!</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tonis_lernzeit</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>  <span class="co"># `tibble` erstellt einen Dataframe</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_toni</span>, newdata <span class="op">=</span> <span class="va">tonis_lernzeit</span><span class="op">)</span></span>
<span><span class="co">##  1 </span></span>
<span><span class="co">## 46</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>predict</code> erwartet für das Argument <code>newdata</code> einen Dataframe. In diesem Beispiel heißt er <code>tonis_lernzeit</code>.</p>
</section><section id="spezifikation-eines-geradenmodells" class="level3" data-number="9.3.2"><h3 data-number="9.3.2" class="anchored" data-anchor-id="spezifikation-eines-geradenmodells">
<span class="header-section-number">9.3.2</span> Spezifikation eines Geradenmodells</h3>
<p>Ein Geradenmodell kann man im einfachsten Fall spezifizieren wie <a href="#eq-mod1" class="quarto-xref">Gleichung&nbsp;<span>9.2</span></a> dargestellt.</p>
<p><span id="eq-mod1"><span class="math display">\[\color{ycol}{\hat{y}} \sim \color{xcol}{\text{x}} \tag{9.2}\]</span></span></p>
<p>Lies: “Laut meinem Modell ist mein vorhergesagtes <span class="math inline">\(\color{ycol}{\hat{y}}\)</span> irgendeine Funktion von <span class="math inline">\(\color{xcol}{\text{x}}\)</span>”. Wir erinnern uns, dass <span class="math inline">\(\color{ycol}{Y}\)</span> die <span class="math inline">\(\color{ycol}{AV}\)</span> und <span class="math inline">\(\color{xcol}{X}\)</span> die <span class="math inline">\(\color{xcol}{UV}\)</span> ist: <span class="math inline">\(\color{ycol}{AV} \sim \color{xcol}{UV}\)</span>.</p>
<p>Wir werden als Funktion nur Geraden verwenden. Die genauen Werte der Gerade lassen wir uns vom Computer ausrechnen. <a href="#eq-mod1" class="quarto-xref">Gleichung&nbsp;<span>9.2</span></a> können Sie so ins Errische übersetzen: <code>lm(y ~ x, data = meine_daten)</code>.</p>
<p><code>lm</code> steht für “lineares Modell”, also eine Gerade als Modell. Die Gerade nennt man auch <em>Regressionsgerade</em> (an anderer Stelle in diesem Buch unscharf als “Trendgerade” bezeichnet).</p>
<div id="exm-noten5" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.4 (Zahlen für Toni)</strong></span> Toni ist nicht zufrieden mit Ihren Vorhersagen: “Jetzt hör mal auf mit deinem Lineal hier herum zu malen. Ich will es genau wissen, sage mir präzise Zahlen!”.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_toni</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">noten2</span><span class="op">)</span></span>
<span><span class="va">lm_toni</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = y ~ x, data = noten2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)            x  </span></span>
<span><span class="co">##      46.191        0.879</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R gibt Ihnen die beiden Koeffizienten für die Gerade aus. Den Namen des Objekts können Sie frei aussuchen, z.<span class="math inline">\(\,\)</span>B. <code>mein_erstes_lm</code>. Die Regressionsgleichung lautet demnach: <code>y_pred = 8.6 + 0.88*x</code>.</p>
<p><code>8.6</code> ist der Achsenabschnitt, d.<span class="math inline">\(\,\)</span>h. der Wert von <span class="math inline">\(\color{ycol}{Y}\)</span> wenn <span class="math inline">\(\color{xcol}{x}=0\)</span>. <code>0.88</code> ist das Regressionsgewicht, d.<span class="math inline">\(\,\)</span>h. die Steigung der Regressionsgeraden: Für jede Stunde Lernzeit steigt der vorhergesagte Klausurerfolg um <code>0.88</code> Punkte.</p>
<p>Mit Kenntnis der beiden Koeffizienten kann man beliebige <span class="math inline">\(\color{ycol}{Y}\)</span>-Werte ausrechnen, gegeben bestimmte <span class="math inline">\(\color{xcol}{X}\)</span>-Werte. Hat jemand zum Beispiel 73 Stunden gelernt, würden wir folgendes Klausurergebnis vorhersagen:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lernzeit</span> <span class="op">&lt;-</span> <span class="fl">73</span></span>
<span><span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fl">46</span> <span class="op">+</span> <span class="fl">0.88</span><span class="op">*</span><span class="va">lernzeit</span></span>
<span><span class="va">y_pred</span></span>
<span><span class="co">## [1] 110</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-noten6" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.5 (Vorhersage für Klausurerfolg, nächster Versuch)</strong></span> Sie versuchen, noch etwas Gutes für Toni zu tun. R hilft Ihnen dabei und rechnet die erwartete Punktzahl aus, wenn Toni 73 Stunden lernt. Sie dürfen es aber auch selber rechnen, wenn Ihnen das lieber ist.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tonis_lernzeit2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">73</span><span class="op">)</span>  </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>tonis_lernzeit2</code> ist eine Tabelle mit einer Zeile und einer Spalte:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tonis_lernzeit2</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">x</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">73</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_toni</span>, newdata <span class="op">=</span> <span class="va">tonis_lernzeit2</span><span class="op">)</span></span>
<span><span class="co">##   1 </span></span>
<span><span class="co">## 110</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Syntax von <code>predict</code> lautet:</p>
<pre><code>predict(modell, newdata = tabelle_mit_prädiktorwerten)</code></pre>
<p>Die Funktion <code>predict</code> liefert eine Vorhersage für ein ein Modell, z.<span class="math inline">\(\,\)</span>B. <code>lm_toni</code>, und für einen bestimmten Dataframe (der die Werte der UV enthalten muss).</p>
</section><section id="vorhersagefehler" class="level3" data-number="9.3.3"><h3 data-number="9.3.3" class="anchored" data-anchor-id="vorhersagefehler">
<span class="header-section-number">9.3.3</span> Vorhersagefehler</h3>
<p>Die Differenz zwischen vorhergesagtem Wert für eine (neue) Beobachtung, <span class="math inline">\(\color{modelcol}{\hat{y_0}}\)</span> und ihrem tatsächlichen Wert nennt man Vorhersagefehler (error, <span class="math inline">\(e\)</span>) oder <em>Residuum</em>: <span class="math inline">\(\color{errorcol}{e_i} = \color{ycol}{y_i} - \color{modelcol}{\hat{y}_i}\)</span>.</p>
<div id="fig-resid" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-resid" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-resid-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-resid-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-resid-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-resid">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-resid-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Geradenmodell (lm_toni)
</figcaption></figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-resid" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-resid-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-resid-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-resid-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-resid">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-resid-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Punktmodell (lm0)
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.7: Vorhersagefehler als Abweichungsbalken. (a) Beim Geradenmodell, sind die Vorhersagefehler (Abweichungsbalken) kleiner (kürzer) als in (b), beim Punktmodell.
</figcaption></figure>
</div>
<p>Wie ist es mit den Vorhersagefehlern von beiden Modellen bestellt? Lassen wir uns von R die Streuung (Residuen) in Form der mittleren Absolutabweichung (MAE) ausgeben (aus dem Paket <code>easystats</code>):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mae</span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="fu">mae</span><span class="op">(</span><span class="va">lm_toni</span><span class="op">)</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## [1] 8</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vergleichen wir MAE im Nullmodell mit MAE in <code>lm_toni</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">verhaeltnis_fehler_mae</span> <span class="op">&lt;-</span> <span class="fu">mae</span><span class="op">(</span><span class="va">lm_toni</span><span class="op">)</span> <span class="op">/</span> <span class="fu">mae</span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="va">verhaeltnis_fehler_mae</span></span>
<span><span class="co">## [1] 0.71</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ah! Das Geradenmodell ist viel besser: Von <code>lm0</code> zu <code>lm_toni</code> haben die mittlere Absolutlänge des Fehlerbalkens auf 71 Prozent verbessert. Nicht schlecht!</p>
<div id="def-fehlerstreung" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.4 (Fehlerstreuung)</strong></span> Als Fehlerstreuung bezeichnen wir die Verteilung der Abweichungen der beobachteten Werte (<span class="math inline">\(y_i\)</span>) vom vorhergesagten Wert (<span class="math inline">\(\hat{y}_i\)</span>). <span class="math inline">\(\square\)</span></p>
</div>
<p>Zur Berechnung der Fehlerstreuung gibt es mehrere Kenngrößen wie MAE oder MSE. Ein Geradenmodell ist immer besser als ein Punktmodell (im Hinblick auf die Verringerung der Fehlerstreuung), solange X mit Y korreliert ist. Natürlich können wir – in Analogie zur Varianz – auch den mittleren Quadratfehlerbalken (Mean Squared Error, MSE) berechnen. Wer mag, kann den MSE auch von Hand berechnen: <code>mean((noten2$y - mean(noten2$y))^2)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mse</span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="fu">mse</span><span class="op">(</span><span class="va">lm_toni</span><span class="op">)</span></span>
<span><span class="co">## [1] 193</span></span>
<span><span class="co">## [1] 106</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">verhaeltnis_fehler_mse</span> <span class="op">&lt;-</span> <span class="fu">mse</span><span class="op">(</span><span class="va">lm_toni</span><span class="op">)</span><span class="op">/</span><span class="fu">mse</span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="va">verhaeltnis_fehler_mse</span></span>
<span><span class="co">## [1] 0.55</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Betrachtet man die MSE, so kann man eine Verbesserung um 0.45 auf 0.55 feststellen.</p>
</section><section id="berechnung-der-modellkoeffizienten" class="level3" data-number="9.3.4"><h3 data-number="9.3.4" class="anchored" data-anchor-id="berechnung-der-modellkoeffizienten">
<span class="header-section-number">9.3.4</span> Berechnung der Modellkoeffizienten</h3>
<p>Aber wie legt man die Regressionsgerade in das Streudiagramm, bildlich gesprochen? Die Regressionskoeffizienten (hier synonym: Modellparameter) <span class="math inline">\(\beta_0\)</span> und <span class="math inline">\(\beta_1\)</span> wählt man so, dass die <em>Residuen</em> <em>minimal</em> sind. Genauer gesagt wird die Summe der quadrierten <span class="green">Residuen</span> minimiert, s. <a href="#eq-min" class="quarto-xref">Gleichung&nbsp;<span>9.3</span></a>.</p>
<p><a href="#fig-opt" class="quarto-xref">Abbildung&nbsp;<span>9.8</span></a> veranschaulicht die Minimierung der Residuen (Vorhersagefehler).</p>
<div id="fig-opt" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-opt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Minimierung der Residuen</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Minimierung der quadrierten Residuen</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/RegressionSpring.gif" class="img-fluid figure-img"></p>
<figcaption>Berechnung der Modellkoeffizienten durch Minimierung der Residuen</figcaption></figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/RegressionRSS.gif" class="img-fluid figure-img"></p>
<figcaption>Minimierung der quadrierten Residuen</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-opt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.8: Bildquelle: <a href="https://www.fom-blog.de/autorinnen-und-autoren/karsten-luebke">Karsten Lübke, FOM Hochschule</a>
</figcaption></figure>
</div>
<p><span id="eq-min"><span class="math display">\[\text{min}\sum_i \color{errorcol}{e_i}^2 \tag{9.3}\]</span></span></p>
<p>Es gibt verschiedene Methoden, um die Koeffizienten zu berechnen (die aber nicht in diesem Buch zu finden sind). Eine schöne Darstellung dazu findet sich bei <span class="citation" data-cites="kaplan_statistical_2009">Kaplan (<a href="references.html#ref-kaplan_statistical_2009" role="doc-biblioref">2009</a>)</span>.</p>
<p>“Von Hand” können Sie die Optimierung von <span class="math inline">\(\beta_0\)</span> und <span class="math inline">\(\beta1\)</span> in dieser App der FOM-Hochschule<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> ausprobieren.</p>
</section></section><section id="r2-als-maß-der-modellgüte" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="r2-als-maß-der-modellgüte">
<span class="header-section-number">9.4</span> <span class="math inline">\(R^2\)</span> als Maß der Modellgüte</h2>
<p>Das Modell <code>lm_toni</code> weist noch 0.55 der Fehlerstreuung (MSE) des Nullmodells auf. Anders gesagt, wir haben uns ( (bzw. das Modell hat sich) um <span class="math inline">\(1 - 0.55\)</span> verbessert.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="va">verhaeltnis_fehler_mse</span></span>
<span><span class="co">## [1] 0.45</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="def-r2" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.5 (<span class="math inline">\(R^2\)</span>-Quadrat)</strong></span> Der Anteil der Verringerung (als Anteil) der Fehlerstreuung der Zielvariablen zwischen <code>lm0</code> und dem gerade untersuchten Modell nennt man <em>R-Quadrat</em> (<span class="math inline">\(R^2\)</span>). Das R-Quadrat (<span class="math inline">\(R^2\)</span>) eines Modells <span class="math inline">\(m\)</span> ist definiert als die Verringerung der Streuung, wenn man das Modell <span class="math inline">\(m\)</span> mit dem Nullmodell <span class="math inline">\(m_0\)</span> vergleicht: <span class="math inline">\(R^2 =1-  \frac{\text{MSE}_{m}}{\text{MSE}_{m0}}\)</span>. R-Quadrat ist ein Maß der <em>Modellgüte</em>: Je größer <span class="math inline">\(R^2\)</span>, desto besser ist die Vorhersage. Da es ein Anteilsmaß ist, liegt der Wertebereich zwischen 0 und 1. Im Nullmodell beträgt R-Quadrat per Definition Null. Im Fall von Modellen des Typs <span class="math inline">\(y\sim x\)</span> gilt: <span class="math inline">\(R^2 = r_{xy}^2\)</span>. <span class="math inline">\(\square\)</span></p>
</div>
<p>Einfach gesagt: <span class="math inline">\(R^2\)</span> gibt an, wie gut (zu welchem Anteil) ein Modell die Zielvariable, <span class="math inline">\(y\)</span>, erklärt. Wir können R-Quadrat (<span class="math inline">\(R^2\)</span>) uns von R z.<span class="math inline">\(\,\)</span>B. so ausgeben lassen:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">lm_toni</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.448</span></span>
<span><span class="co">##   adj. R2: 0.442</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bei einer perfekten Korrelation ist <span class="math inline">\(r=1\)</span>, daher ist dann auch <span class="math inline">\(R^2 = 1\)</span>, vgl. <a href="#fig-r2-extreme" class="quarto-xref">Abbildung&nbsp;<span>9.9</span></a>.</p>
<div class="cell" data-layout="[[45,-10,45],[100]]" data-layout-align="center">
<div id="fig-r2-extreme" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-r2-extreme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-r2-extreme" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-r2-extreme-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-r2-extreme-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-r2-extreme-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-r2-extreme">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-r2-extreme-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Keine Korrelation
</figcaption></figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: center;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-r2-extreme" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-r2-extreme-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure"><div aria-describedby="fig-r2-extreme-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-r2-extreme-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%" data-ref-parent="fig-r2-extreme">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-r2-extreme-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Perfekte Korrelation
</figcaption></figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-r2-extreme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.9: Extremfälle von <span class="math inline">\(R^2\)</span>: 0 und 1. (a) Keine Korrelation, r = 0 und R2 = 0. Prognose durch Mittelwert; die Regressionsgerade ist (ungefähr) parallel zur X-Achse. (b) Perfekte Korrelation, r = 1 und <span class="math inline">\(R^2\)</span> = 1: Die Prognose ist gleich dem beobachtetem Wert.
</figcaption></figure>
</div>
</div>
<p>Bei einer perfekten Korrelation <span class="math inline">\(R^2=1\)</span> liegen die Punkte auf der Geraden. Im gegenteiligen Extremfall von <span class="math inline">\(R^2=0\)</span> ist die Vorhersage genauso gut, wie wenn man für jedes <span class="math inline">\(y\)</span> den Mittelwert, <span><span class="math inline">\(\color{ycol}{\bar{y}}\)</span></span> , vorhersagen würde. Je größer R-Quadrat, desto besser passt das Modell zu den Daten; desto besser “erklärt” das Modell die Daten (desto besser der “Fit” des Modells zu den Daten, sagt man).</p>
<p><a href="https://fomshinyapps.shinyapps.io/Variationszerlegung/">Diese App der FOM-Hochschule</a> erlaubt es Ihnen mit der Größe der Residuen eines linearen Modells zu spielen.</p>
<!-- ### Addition der Varianzen -->
<!-- Nennen wir die Varianz des Verkaufspreis $s^2_y$, die Verbesserung der Fehlerstreuung durch das *M*odell $s^2_m$ und die restliche Fehlerstreuung, den MSE, $s^2_e$. -->
<!-- Dann gilt: -->
<!-- $$s^2_y = s^2_m + s^2_e \\ -->
<!-- s^2_m = s^2_y - s^2_e$$ -->
<!-- ```{r} -->
<!-- s2_y = var(noten2$y) -->
<!-- s2_e = mse(lm_toni) -->
<!-- s2_m = s2_y - s2_e -->
<!-- s2_m -->
<!-- ``` -->
<!-- Die Varianzanteile addieren sich. Mit anderen Kennzahlen der Streuung (SD, MAE) funktioniert das nicht. -->
</section><section id="sec-interpret-reg-mod" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="sec-interpret-reg-mod">
<span class="header-section-number">9.5</span> Interpretation eines Regressionsmodells</h2>
<section id="modellgüte" class="level3" data-number="9.5.1"><h3 data-number="9.5.1" class="anchored" data-anchor-id="modellgüte">
<span class="header-section-number">9.5.1</span> Modellgüte</h3>
<p>Die Residuen (Vorhersagefehler) bestimmen die Modellgüte: Sind die Residuen im Schnitt groß, so ist die Modellgüte gering (schlecht), und umgekehrt. Verschiedenen Koeffizienten stehen zur Verfügung: <span class="math inline">\(R^2\)</span>, <span class="math inline">\(r\)</span> (als Korrelation von tatsächlichem <span class="math inline">\(y\)</span> und vorhergesagten <span class="math inline">\(\hat{y}\)</span>), MSE, RMSE, MAE, …</p>
</section><section id="koeffizienten" class="level3" data-number="9.5.2"><h3 data-number="9.5.2" class="anchored" data-anchor-id="koeffizienten">
<span class="header-section-number">9.5.2</span> Koeffizienten</h3>
<p>Die Modellkoeffizienten, also Achsenabschnitt (<span class="math inline">\(\beta_0\)</span>) und Steigung (<span class="math inline">\(\beta_1\)</span>) sind nur eingeschränkt zu interpretieren, wenn man die zugrundeliegenden kausalen Abhängigkeiten nicht kennt. Allein aufgrund eines statistischen Zusammenhangs darf man keine kausalen Abhängigkeiten annehmen. Ohne eine zugrundeliegende Theorie für eine Kausalbehauptung kann man kann nur <em>deskriptiv</em> argumentieren. Oder sich mit der Modellgüte und den Vorhersagen begnügen. Was auch was wert ist.</p>
<p><span>Im Modell <code>lm_toni</code> liegt der Achsenabschnitt bei <span class="math inline">\(\textcolor{ycol}{y}=46.19\)</span>. Beobachtungen mit <span class="math inline">\(\color{xcol}{x}=0\)</span> können also diesen <span class="math inline">\(\textcolor{ycol}{Y}\)</span>-Wert erwarten, laut <code>lm_toni</code>.</span> Leider ist es häufig so, dass UV mit Wert 0 in der Praxis nicht realistisch sind, so dass der Achsenabschnitt dann wenig nützt.</p>
<div id="exm-groesse" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 9.6 (Regression Größe und Gewicht)</strong></span> Nutzt man Körpergröße und das Gewicht von Menschen vorherzusagen, ist der Achsenabschnitt von Körpergröße wenig nützlich, da es keine Menschen gibt der Größe 0. <span class="math inline">\(\square\)</span></p>
</div>
<p>So interpretiert man die Geradensteigung, <span class="math inline">\(\beta_1\)</span>: “Im Modell <code>lm_toni</code> beträgt der Regressionskoeffizient <span class="math inline">\(\beta_1 = 0.88\)</span>. Zwei Studentinnen, deren Lernzeit sich um eine Stunde unterscheidet, unterscheiden sich <em>laut Modell</em> um den Wert von <span class="math inline">\(\beta_1\)</span>”.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vorsicht
</div>
</div>
<div class="callout-body-container callout-body">
<p>Häufig liest man, der “Effekt der UV” auf die AV betrage z.<span class="math inline">\(\,\)</span>B. <span class="math inline">\(0.88\)</span>. “Effekt” ist aber ein Wort, das man leicht kausal verstehen kann. Ohne weitere Absicherung kann man aber Regressionskoeffizienten <em>nicht</em> kausal verstehen. Daher sollte man das Wort “Effekt” mit Vorsicht genießen. Manche sprechen daher auch von einem “statistischen Effekt”, um zu verdeutlichen, dass keine Kausalaussage impliziert ist. <span class="math inline">\(\square\)</span></p>
</div>
</div>
</section></section><section id="wie-man-mit-statistik-lügt" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="wie-man-mit-statistik-lügt">
<span class="header-section-number">9.6</span> Wie man mit Statistik lügt</h2>
<p>Der Unterschied in Modellgüte zwischen, sagen wir, <span class="math inline">\(r=.1\)</span> und <span class="math inline">\(r=.2\)</span> ist <em>viel kleiner</em> als zwischen <span class="math inline">\(r=.7\)</span> und <span class="math inline">\(r=.8\)</span>. <span class="math inline">\(R^2\)</span> ist ein (lineares) Maß der Modellgüte und da <span class="math inline">\(r = \sqrt{R^2}\)</span>, dürfen Unterschiede in <span class="math inline">\(r\)</span> nicht auf die gleiche Weise interpretiert werden wie Unterschiede in <span class="math inline">\(R^2\)</span>. <a href="#fig-r-r2" class="quarto-xref">Abbildung&nbsp;<span>9.10</span></a> zeigt den Zusammenhang von <span class="math inline">\(r\)</span> und <span class="math inline">\(R^2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-r-r2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-r-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-r-r2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-r-r2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.10: Der Zusammenhang von r und R-Quadrat ist nicht linear.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vorsicht
</div>
</div>
<div class="callout-body-container callout-body">
<p>Unterschiede zwischen Korrelationsdifferenzen dürfen nicht linear interpretiert werden. <span class="math inline">\(\square\)</span></p>
</div>
</div>
</section><section id="fallbeispiel-mariokart" class="level2" data-number="9.7"><h2 data-number="9.7" class="anchored" data-anchor-id="fallbeispiel-mariokart">
<span class="header-section-number">9.7</span> Fallbeispiel Mariokart</h2>
<section id="der-datenwahrsager-legt-los" class="level3" data-number="9.7.1"><h3 data-number="9.7.1" class="anchored" data-anchor-id="der-datenwahrsager-legt-los">
<span class="header-section-number">9.7.1</span> Der Datenwahrsager legt los</h3>
<p>Als mittlerweile anerkannter Extrem-Datenanalyst in dem Online-Auktionshaus, in dem Sie arbeiten, haben Sie sich neue Ziele gesetzt. Sie möchten eine genaue Vorhersage von Verkaufspreisen erzielen. Als Sie von diesem Plan berichteten, leuchteten die Augen Ihrer Chefin. Genaue Vorhersagen sind von hoher betriebswirtschaftlicher Relevanz. Mariokart-Daten laden, am besten ohne Extremwerte, s. <a href="040-verbildlichen.html#lst-no-extreme" class="quarto-xref">Listing&nbsp;<span>5.4</span></a> und los geht’s (und die üblichen Pakete starten, nicht vergessen)!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mariokart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/openintro/mariokart.csv"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total_pr</span> <span class="op">~</span> <span class="va">start_pr</span>, data <span class="op">=</span> <span class="va">mariokart</span><span class="op">)</span></span>
<span><span class="fu">r2</span><span class="op">(</span><span class="va">lm2</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.005</span></span>
<span><span class="co">##   adj. R2: -0.002</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Oh nein! Unterirdisch schlecht. Anstelle von bloßem Rumprobieren überlegen Sie und schauen dann nach, welche Variable am stärksten korreliert mit <code>total_pr</code>; es resultiert <code>lm3</code>. Dann lassen Sie sich die Modellparameter ausgeben, s. <a href="#tbl-lm3" class="quarto-xref">Tabelle&nbsp;<span>9.1</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total_pr</span> <span class="op">~</span> <span class="va">ship_pr</span>, data <span class="op">=</span> <span class="va">mariokart</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div id="tbl-lm3" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.1: Modellparameter von lm3
</figcaption><div aria-describedby="tbl-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(141)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">36.25</td>
<td style="text-align: center;">2.54</td>
<td style="text-align: center;">(31.23, 41.26)</td>
<td style="text-align: center;">14.28</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">ship pr</td>
<td style="text-align: center;">4.34</td>
<td style="text-align: center;">0.57</td>
<td style="text-align: center;">(3.22, 5.46)</td>
<td style="text-align: center;">7.67</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Der Achsenabschnitt liegt bei ca. 36 Dollar, wie man in <a href="#tbl-lm3" class="quarto-xref">Tabelle&nbsp;<span>9.1</span></a> sieht: Ein Spiel, das mit null Dollar Preis startet, kann laut <code>lm3</code> etwa 36 Dollar finaler Verkaufspreis erwarten. <em>Pro Dollar an Versandkosten</em> (<code>ship_pr</code>) steigt der zu erwartende finale Verkaufspreis um ca. 4 Dollar. (Die Spalte <code>95 CI</code> gibt einen Schätzbereich für den jeweiligen Modellkoeffizienten an, denn es handelt sich bei den Koeffizienten um Schätzwerte; der wahre Wert in der Population ist unbekannt. Wir kennen schließlich nur eine Stichprobe der Größe <span class="math inline">\(n = 143\)</span>.) Die Regressionsgleichung von <code>lm3</code> lautet demnach: <code>total_pr_pred = 36 + 4*ship_pr</code>.</p>
<p>In Worten:</p>
<blockquote class="blockquote">
<p>Der vorhergesagte Gesamptreis eines Spiels liegt bei 36 Dollar “Sockelbetrag” plus 4 mal die Versandkosten.</p>
</blockquote>
</section><section id="vertiefung" class="level3" data-number="9.7.2"><h3 data-number="9.7.2" class="anchored" data-anchor-id="vertiefung">
<span class="header-section-number">9.7.2</span> Vertiefung</h3>
<p>Man kann sich die erwarteten Werte (“expectations”) des Verkaufspreises in Abhängigkeit vom Wert der UV (<code>ship_pr</code>) auch schätzen (“to estimate”) lassen, und zwar so mit <code>estimate_expectation(lm3)</code>, s. <a href="#tbl-lm3-expect" class="quarto-xref">Tabelle&nbsp;<span>9.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div id="tbl-lm3-expect" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lm3-expect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.2: Die vorhergesagten (predicted) Werte und die Abweichungen vom vorhergesagten Wert (Residuals)
</figcaption><div aria-describedby="tbl-lm3-expect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Model-based Predictions</caption>
<thead><tr class="header">
<th style="text-align: left;">ship_pr</th>
<th style="text-align: right;">Predicted</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">95% CI</th>
<th style="text-align: right;">Residuals</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4.00</td>
<td style="text-align: right;">53.59</td>
<td style="text-align: right;">1.87</td>
<td style="text-align: right;">(49.89, 57.30)</td>
<td style="text-align: right;">-2.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.99</td>
<td style="text-align: right;">53.55</td>
<td style="text-align: right;">1.87</td>
<td style="text-align: right;">(49.85, 57.25)</td>
<td style="text-align: right;">-16.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.50</td>
<td style="text-align: right;">51.43</td>
<td style="text-align: right;">1.82</td>
<td style="text-align: right;">(47.82, 55.03)</td>
<td style="text-align: right;">-5.93</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.00</td>
<td style="text-align: right;">36.25</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">(31.23, 41.26)</td>
<td style="text-align: right;">7.75</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.00</td>
<td style="text-align: right;">36.25</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">(31.23, 41.26)</td>
<td style="text-align: right;">34.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.00</td>
<td style="text-align: right;">53.59</td>
<td style="text-align: right;">1.87</td>
<td style="text-align: right;">(49.89, 57.30)</td>
<td style="text-align: right;">-8.59</td>
</tr>
</tbody>
</table>
<p><em>Variable predicted: total_pr</em></p>
</div>
</div>
</figure>
</div>
</div>
<p>“Ah, bei 4 Dollar Versandkosten ist laut dem Modell knapp 54 Dollar Verkaufspreis zu erwarten”, fassen Sie sich die Ausgabe zusammen.</p>
<blockquote class="blockquote">
<p><span>🤖</span> Das sieht man in der Spalte <code>Predicted</code>, dort steht der vorhersagte Wert für <code>total_pr</code> für einen bestimmten Wert von <code>ship_pr</code>.</p>
</blockquote>
<blockquote class="blockquote">
<p><span>🧑‍🎓</span> Kann ich auch <code>predict</code> benutzen? Ich würde gerne den Verkaufspreis wissen, wenn die Versandkosten bei 1 und bei 4 Dollar liegen.</p>
</blockquote>
<blockquote class="blockquote">
<p><span>🤖</span> Ja, klar!</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">neue_daten</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  ship_pr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="co"># zwei Werte zum Vorhersagen</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm3</span>, newdata <span class="op">=</span> <span class="va">neue_daten</span><span class="op">)</span></span>
<span><span class="co">##  1  2 </span></span>
<span><span class="co">## 41 54</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aber nützlich wäre noch, das Modell (bzw. die Schätzung der erwarteten Werte) als Diagramm zu bekommen. Das erreicht man z.<span class="math inline">\(\,\)</span>B. so, s. <a href="090-regression2.html#fig-lm3" class="quarto-xref">Abbildung&nbsp;<span>10.10</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">estimate_prediction</span><span class="op">(</span><span class="va">lm3</span>, by <span class="op">=</span> <span class="st">"ship_pr"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lm3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="080-regression1_files/figure-html/fig-lm3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;9.11: Verbildlichung der erwarteteten Werte laut lm3
</figcaption></figure>
</div>
</div>
</div>
<p><code>estimate_expectation</code> heißt sinngemäß “schätze den zu erwartenden Wert”. Kurz gesagt: Wir wollen eine Vorhersage von R.</p>
<p>Am wichtigsten ist Ihnen aber im Moment die Frage, wie “gut” das Modell ist, spricht wie lang oder kurz die (absoluten) Vorhersagefehler-Balken sind:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mae</span><span class="op">(</span><span class="va">lm3</span><span class="op">)</span></span>
<span><span class="co">## [1] 13</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das Modell erklärt einen Anteil von ca. 0.29 der Gesamtstreuung.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">lm3</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.294</span></span>
<span><span class="co">##   adj. R2: 0.289</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mae</span><span class="op">(</span><span class="va">lm3</span><span class="op">)</span></span>
<span><span class="co">## [1] 13</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im nächsten Meeting erzählen Sie Ihrer Chefin “Ich kann den Verkaufspreis von Mariokart-Spielen im Schnitt auf 13 Dollar genau vorhersagen!”. Hört sich gut an. Allerdings hätte es Ihre Chefin gerne genauer. Kann man da noch was machen?</p>
</section></section><section id="fallstudie-immobilienpreise" class="level2" data-number="9.8"><h2 data-number="9.8" class="anchored" data-anchor-id="fallstudie-immobilienpreise">
<span class="header-section-number">9.8</span> Fallstudie Immobilienpreise</h2>
<!-- ## Fallstudie Immobilienpreise -->
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vorsicht
</div>
</div>
<div class="callout-body-container callout-body">
<p>Diese Fallstudie führt in die Prüfungsleistung “Prognosewettbewerb” ein. Es empfiehlt sich für Sie, diese Fallstudie sorgsam zu bearbeiten. <span class="math inline">\(\square\)</span></p>
</div>
</div>
<section id="hintergrund" class="level3" data-number="9.8.1"><h3 data-number="9.8.1" class="anchored" data-anchor-id="hintergrund">
<span class="header-section-number">9.8.1</span> Hintergrund</h3>
<p>In dieser Fallstudie geht es darum, die Preise von Immobilien vorherzusagen. Kurz gesagt: Sagen Sie die Hauspreise vorher, und reichen Sie Ihre Vorhersagen als CSV bei <a href="https://www.kaggle.com/">kaggle.com</a> ein. Kaggle ist eine Webseite, die Prognosewettbewerbe veranstaltet. In dieser Fallstudie nehmen Sie teil an der Kaggle-Competition <a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview">“House Prices - Advanced Regression Techniques”</a>, die Sie auf der Kaggle-Webseite finden. Dort finden Sie auch eine nähere Beschreibung, das Ziel und die Spielregeln des Wettbewerbs.</p>
<ul>
<li><a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview/description">Beschreibung</a></li>
<li><a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview/evaluation">Ziel/Aufgabe</a></li>
<li><a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/rules">Spielregeln</a></li>
</ul></section><section id="daten" class="level3" data-number="9.8.2"><h3 data-number="9.8.2" class="anchored" data-anchor-id="daten">
<span class="header-section-number">9.8.2</span> Daten</h3>
<p>Sie können die Daten von <a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/data">www.kaggle.com herunterladen</a>. Im Einzelnen müssen Sie folgende Dateien herunterladen:</p>
<ul>
<li>
<em>Data_description.txt</em>: Codebook, d.<span class="math inline">\(\,\)</span>h. Beschreibung der Variablen im Datensatz</li>
<li>
<em>train.csv</em>: Daten von Häusern, die Sie nutzen, um Modelle zu erstellen</li>
<li>
<em>test.csv</em>: Daten von Häusern, von denen Sie den Kaufpreis vorhersagen sollen</li>
<li>
<em>sample_submission.csv</em>: Beispielhafte Prognosedatei, die Datei also, mit der Sie Ihre Vorhersagen einreichen, s. <a href="#tbl-subm" class="quarto-xref">Tabelle&nbsp;<span>9.3</span></a>
</li>
</ul>
<p>Sie können auch über das Github-Repo <code>statistik1</code>, Ordner <code>data</code> auf die Daten zugreifen:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_train_path_online</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"https://raw.githubusercontent.com/sebastiansauer/statistik1/"</span>,</span>
<span>    <span class="st">"refs/heads/main/data/kaggle-train.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_test_path_online</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span><span class="st">"https://raw.githubusercontent.com/sebastiansauer/statistik1/"</span>,</span>
<span>    <span class="st">"refs/heads/main/data/kaggle-test.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">d_train_path_online</span><span class="op">)</span></span>
<span><span class="va">d_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">d_test_path_online</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Laden Sie diese Daten am besten herunter und speichern Sie sie in einem passenden Unterverzeichnis (Ihres Projektordners in RStudio) ab. Importieren wir die Daten aus dem Unterordner <code>data</code> in R (davon ausgehend, dass der Unterordner <code>data</code> ein Unterordner Ihres aktuellen R-Projekts ist):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_train_path</span> <span class="op">&lt;-</span> <span class="st">"data/kaggle-train.csv"</span></span>
<span><span class="va">d_test_path</span> <span class="op">&lt;-</span> <span class="st">"data/kaggle-test.csv"</span></span>
<span><span class="va">d_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">d_train_path</span><span class="op">)</span></span>
<span><span class="va">d_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">d_test_path</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wenn das Importieren von Ihrem Computer nicht klappen sollte … Es ist zwar hilfreich, wenn man Daten von der eigenen Festplatte importieren kann. Aber fürs Erste können Sie die Daten auch von oben angegeben Online-Pfad importieren.</p>
</section><section id="prognosedatei" class="level3" data-number="9.8.3"><h3 data-number="9.8.3" class="anchored" data-anchor-id="prognosedatei">
<span class="header-section-number">9.8.3</span> Prognosedatei</h3>
<p>Die Prognosedatei ist die Datei, die Ihre Vorhersagen (Prognosen) enthält. Sie soll prinzipiell so aussehen wie in <a href="#tbl-subm" class="quarto-xref">Tabelle&nbsp;<span>9.3</span></a> dargestellt.</p>
<div class="cell" data-layout-align="center">
<div id="tbl-subm" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-subm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.3: Beispiel für den Aufbau der Prognose-Datei
</figcaption><div aria-describedby="tbl-subm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">SalePrice</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1461</td>
<td style="text-align: right;">169277</td>
</tr>
<tr class="even">
<td style="text-align: right;">1462</td>
<td style="text-align: right;">187758</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1463</td>
<td style="text-align: right;">183584</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Die Prognosedatei besteht also aus zwei Spalten: der Spalte <code>id</code> und der Spalte <code>Saleprice</code>. Die Spalte <code>id</code> gibt an, welches Haus in einer bestimmten Zeile Ihrer Prognosedatei gemeint ist – für welches Haus Sie also gerade einen Kaufpreis vorhersagen. die Spalte <code>SalePrice</code> enthält Ihre Vorhersage für den Kaufpreis das Hauses mit der Id, die in der betreffenden Zeile steht. Insgesamt soll die Prognosedatei genau so viele Zeilen haben wie der Test-Datensatz, also die Tabelle, die die vorherzusagenden Werte angibt. Alles klar? Los geht’s!</p>
</section><section id="ein-erster-blick-in-die-daten" class="level3" data-number="9.8.4"><h3 data-number="9.8.4" class="anchored" data-anchor-id="ein-erster-blick-in-die-daten">
<span class="header-section-number">9.8.4</span> Ein erster Blick in die Daten</h3>
<p>Schauen Sie sich zu Beginn einmal die Verteilung der metrischen Variablen, z.<span class="math inline">\(\,\)</span>B. mit <code>describe_distribution(d_train)</code> an.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 21%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: center;">Mean</th>
<th style="text-align: center;">SD</th>
<th style="text-align: center;">IQR</th>
<th style="text-align: center;">Range</th>
<th style="text-align: center;">Skewness</th>
<th style="text-align: center;">Kurtosis</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">n_Missing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Id</td>
<td style="text-align: center;">730.50</td>
<td style="text-align: center;">421.61</td>
<td style="text-align: center;">730.50</td>
<td style="text-align: center;">(1.00, 1460.00)</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">-1.20</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">MSSubClass</td>
<td style="text-align: center;">56.90</td>
<td style="text-align: center;">42.30</td>
<td style="text-align: center;">50.00</td>
<td style="text-align: center;">(20.00, 190.00)</td>
<td style="text-align: center;">1.41</td>
<td style="text-align: center;">1.58</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LotFrontage</td>
<td style="text-align: center;">70.05</td>
<td style="text-align: center;">24.28</td>
<td style="text-align: center;">21.00</td>
<td style="text-align: center;">(21.00, 313.00)</td>
<td style="text-align: center;">2.16</td>
<td style="text-align: center;">17.45</td>
<td style="text-align: center;">1201</td>
<td style="text-align: center;">259</td>
</tr>
<tr class="even">
<td style="text-align: left;">LotArea</td>
<td style="text-align: center;">10516.83</td>
<td style="text-align: center;">9981.26</td>
<td style="text-align: center;">4060.00</td>
<td style="text-align: center;">(1300.00, 2.15e+05)</td>
<td style="text-align: center;">12.21</td>
<td style="text-align: center;">203.24</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OverallQual</td>
<td style="text-align: center;">6.10</td>
<td style="text-align: center;">1.38</td>
<td style="text-align: center;">2.00</td>
<td style="text-align: center;">(1.00, 10.00)</td>
<td style="text-align: center;">0.22</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">OverallCond</td>
<td style="text-align: center;">5.58</td>
<td style="text-align: center;">1.11</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(1.00, 9.00)</td>
<td style="text-align: center;">0.69</td>
<td style="text-align: center;">1.11</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">YearBuilt</td>
<td style="text-align: center;">1971.27</td>
<td style="text-align: center;">30.20</td>
<td style="text-align: center;">46.00</td>
<td style="text-align: center;">(1872.00, 2010.00)</td>
<td style="text-align: center;">-0.61</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">YearRemodAdd</td>
<td style="text-align: center;">1984.87</td>
<td style="text-align: center;">20.65</td>
<td style="text-align: center;">37.00</td>
<td style="text-align: center;">(1950.00, 2010.00)</td>
<td style="text-align: center;">-0.50</td>
<td style="text-align: center;">-1.27</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MasVnrArea</td>
<td style="text-align: center;">103.69</td>
<td style="text-align: center;">181.07</td>
<td style="text-align: center;">166.00</td>
<td style="text-align: center;">(0.00, 1600.00)</td>
<td style="text-align: center;">2.67</td>
<td style="text-align: center;">10.08</td>
<td style="text-align: center;">1452</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">BsmtFinSF1</td>
<td style="text-align: center;">443.64</td>
<td style="text-align: center;">456.10</td>
<td style="text-align: center;">712.75</td>
<td style="text-align: center;">(0.00, 5644.00)</td>
<td style="text-align: center;">1.69</td>
<td style="text-align: center;">11.12</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BsmtFinSF2</td>
<td style="text-align: center;">46.55</td>
<td style="text-align: center;">161.32</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 1474.00)</td>
<td style="text-align: center;">4.26</td>
<td style="text-align: center;">20.11</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">BsmtUnfSF</td>
<td style="text-align: center;">567.24</td>
<td style="text-align: center;">441.87</td>
<td style="text-align: center;">585.00</td>
<td style="text-align: center;">(0.00, 2336.00)</td>
<td style="text-align: center;">0.92</td>
<td style="text-align: center;">0.47</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TotalBsmtSF</td>
<td style="text-align: center;">1057.43</td>
<td style="text-align: center;">438.71</td>
<td style="text-align: center;">503.50</td>
<td style="text-align: center;">(0.00, 6110.00)</td>
<td style="text-align: center;">1.52</td>
<td style="text-align: center;">13.25</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">X1stFlrSF</td>
<td style="text-align: center;">1162.63</td>
<td style="text-align: center;">386.59</td>
<td style="text-align: center;">509.75</td>
<td style="text-align: center;">(334.00, 4692.00)</td>
<td style="text-align: center;">1.38</td>
<td style="text-align: center;">5.75</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X2ndFlrSF</td>
<td style="text-align: center;">346.99</td>
<td style="text-align: center;">436.53</td>
<td style="text-align: center;">728.00</td>
<td style="text-align: center;">(0.00, 2065.00)</td>
<td style="text-align: center;">0.81</td>
<td style="text-align: center;">-0.55</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">LowQualFinSF</td>
<td style="text-align: center;">5.84</td>
<td style="text-align: center;">48.62</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 572.00)</td>
<td style="text-align: center;">9.01</td>
<td style="text-align: center;">83.23</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GrLivArea</td>
<td style="text-align: center;">1515.46</td>
<td style="text-align: center;">525.48</td>
<td style="text-align: center;">649.75</td>
<td style="text-align: center;">(334.00, 5642.00)</td>
<td style="text-align: center;">1.37</td>
<td style="text-align: center;">4.90</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">BsmtFullBath</td>
<td style="text-align: center;">0.43</td>
<td style="text-align: center;">0.52</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 3.00)</td>
<td style="text-align: center;">0.60</td>
<td style="text-align: center;">-0.84</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BsmtHalfBath</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.24</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 2.00)</td>
<td style="text-align: center;">4.10</td>
<td style="text-align: center;">16.40</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">FullBath</td>
<td style="text-align: center;">1.57</td>
<td style="text-align: center;">0.55</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 3.00)</td>
<td style="text-align: center;">0.04</td>
<td style="text-align: center;">-0.86</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HalfBath</td>
<td style="text-align: center;">0.38</td>
<td style="text-align: center;">0.50</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 2.00)</td>
<td style="text-align: center;">0.68</td>
<td style="text-align: center;">-1.08</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">BedroomAbvGr</td>
<td style="text-align: center;">2.87</td>
<td style="text-align: center;">0.82</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 8.00)</td>
<td style="text-align: center;">0.21</td>
<td style="text-align: center;">2.23</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KitchenAbvGr</td>
<td style="text-align: center;">1.05</td>
<td style="text-align: center;">0.22</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 3.00)</td>
<td style="text-align: center;">4.49</td>
<td style="text-align: center;">21.53</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">TotRmsAbvGrd</td>
<td style="text-align: center;">6.52</td>
<td style="text-align: center;">1.63</td>
<td style="text-align: center;">2.00</td>
<td style="text-align: center;">(2.00, 14.00)</td>
<td style="text-align: center;">0.68</td>
<td style="text-align: center;">0.88</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fireplaces</td>
<td style="text-align: center;">0.61</td>
<td style="text-align: center;">0.64</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 3.00)</td>
<td style="text-align: center;">0.65</td>
<td style="text-align: center;">-0.22</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">GarageYrBlt</td>
<td style="text-align: center;">1978.51</td>
<td style="text-align: center;">24.69</td>
<td style="text-align: center;">41.00</td>
<td style="text-align: center;">(1900.00, 2010.00)</td>
<td style="text-align: center;">-0.65</td>
<td style="text-align: center;">-0.42</td>
<td style="text-align: center;">1379</td>
<td style="text-align: center;">81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GarageCars</td>
<td style="text-align: center;">1.77</td>
<td style="text-align: center;">0.75</td>
<td style="text-align: center;">1.00</td>
<td style="text-align: center;">(0.00, 4.00)</td>
<td style="text-align: center;">-0.34</td>
<td style="text-align: center;">0.22</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">GarageArea</td>
<td style="text-align: center;">472.98</td>
<td style="text-align: center;">213.80</td>
<td style="text-align: center;">244.50</td>
<td style="text-align: center;">(0.00, 1418.00)</td>
<td style="text-align: center;">0.18</td>
<td style="text-align: center;">0.92</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WoodDeckSF</td>
<td style="text-align: center;">94.24</td>
<td style="text-align: center;">125.34</td>
<td style="text-align: center;">168.00</td>
<td style="text-align: center;">(0.00, 857.00)</td>
<td style="text-align: center;">1.54</td>
<td style="text-align: center;">2.99</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">OpenPorchSF</td>
<td style="text-align: center;">46.66</td>
<td style="text-align: center;">66.26</td>
<td style="text-align: center;">68.00</td>
<td style="text-align: center;">(0.00, 547.00)</td>
<td style="text-align: center;">2.36</td>
<td style="text-align: center;">8.49</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EnclosedPorch</td>
<td style="text-align: center;">21.95</td>
<td style="text-align: center;">61.12</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 552.00)</td>
<td style="text-align: center;">3.09</td>
<td style="text-align: center;">10.43</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">X3SsnPorch</td>
<td style="text-align: center;">3.41</td>
<td style="text-align: center;">29.32</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 508.00)</td>
<td style="text-align: center;">10.30</td>
<td style="text-align: center;">123.66</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ScreenPorch</td>
<td style="text-align: center;">15.06</td>
<td style="text-align: center;">55.76</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 480.00)</td>
<td style="text-align: center;">4.12</td>
<td style="text-align: center;">18.44</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">PoolArea</td>
<td style="text-align: center;">2.76</td>
<td style="text-align: center;">40.18</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 738.00)</td>
<td style="text-align: center;">14.83</td>
<td style="text-align: center;">223.27</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MiscVal</td>
<td style="text-align: center;">43.49</td>
<td style="text-align: center;">496.12</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">(0.00, 15500.00)</td>
<td style="text-align: center;">24.48</td>
<td style="text-align: center;">701.00</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">MoSold</td>
<td style="text-align: center;">6.32</td>
<td style="text-align: center;">2.70</td>
<td style="text-align: center;">3.00</td>
<td style="text-align: center;">(1.00, 12.00)</td>
<td style="text-align: center;">0.21</td>
<td style="text-align: center;">-0.40</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">YrSold</td>
<td style="text-align: center;">2007.82</td>
<td style="text-align: center;">1.33</td>
<td style="text-align: center;">2.00</td>
<td style="text-align: center;">(2006.00, 2010.00)</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">-1.19</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">SalePrice</td>
<td style="text-align: center;">1.81e+05</td>
<td style="text-align: center;">79442.50</td>
<td style="text-align: center;">84075.00</td>
<td style="text-align: center;">(34900.00, 7.55e+05)</td>
<td style="text-align: center;">1.88</td>
<td style="text-align: center;">6.54</td>
<td style="text-align: center;">1460</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="ein-erstes-vorhersagemodell" class="level3" data-number="9.8.5"><h3 data-number="9.8.5" class="anchored" data-anchor-id="ein-erstes-vorhersagemodell">
<span class="header-section-number">9.8.5</span> Ein erstes Vorhersagemodell</h3>
<p>Eine einfache Antwort auf die Frage, welche Variablen sich zur Vorhersage eignen, ist, die Korrelation aller UV mit der AV zu berechnen, s. <!-- @tbl-d_train_corr und --> <a href="#lst-get-high-corrs" class="quarto-xref">Listing&nbsp;<span>9.2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div id="lst-get-high-corrs" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-get-high-corrs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;9.2: Welche Variablen korrelieren stärker als .3?
</figcaption><div aria-describedby="lst-get-high-corrs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_train</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">correlation</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># berechne Korrelationen</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Parameter2</span> <span class="op">==</span> <span class="st">"SalePrice"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># aber nur, wo die zweite Variable "SalesPrice" ist</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># sortiere absteigend nach der Höhe des Korrelationskoeffizienten r</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">.3</span><span class="op">)</span>  <span class="co"># nur |r| &gt; .3</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<div id="tbl-d_train_corr" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-d_train_corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.4: Korrelation der UV mit der AV
</figcaption><div aria-describedby="tbl-d_train_corr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>

</div>
</div>
</figure>
</div>
<p>Aha! Ein Menge Information … Wenn Sie Teile der Ausgabe der Tabelle nicht verstehen: Im Zweifel einfach ignorieren. Wenn Sie die R-Syntax nicht verstehen: Führen Sie die Syntax schrittweise aus. Zuerst <code>d_train</code> ausführen und das Ergebnis betrachten. Dann <code>d_train %&gt;% select(-Id)</code> ausführen, wieder die Ausgabe betrachten, usw. Die als Output von <a href="#lst-get-high-corrs" class="quarto-xref">Listing&nbsp;<span>9.2</span></a> aufgeführten Variablen sind einigermaßen stark mit unserer Zielvariablen <code>SalePrice</code> korreliert. Nutzen wir also diese Variablen (oder einige von ihnen) zur Vorhersage. <a href="#tbl-ames-lm_immo1" class="quarto-xref">Tabelle&nbsp;<span>9.5</span></a> zeigt die Parameter von <code>lm_immo1</code>.</p>
<p>Im ersten Modell gehen wir davon aus, dass der Verkaufspreis im Großen und Ganzen durch den Zustand der Immobilie (<code>OverallQual</code>) vorhergesagt werden kann. Diese Variable ist am stärksten mit der Zielvariable korreliert und daher ein guter Kandidat für die Vorhersage.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_immo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SalePrice</span> <span class="op">~</span> <span class="va">OverallQual</span>, data <span class="op">=</span> <span class="va">d_train</span><span class="op">)</span></span>
<span><span class="fu">parameters</span><span class="op">(</span><span class="va">lm_immo1</span><span class="op">)</span>  <span class="co"># aus easystats</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div id="tbl-ames-lm_immo1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ames-lm_immo1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.5: Parameter von <code>lm_immo1</code>
</figcaption><div aria-describedby="tbl-ames-lm_immo1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Fixed Effects</caption>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-96206.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">OverallQual</td>
<td style="text-align: center;">45435.80</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Wie gut ist das Modell?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rmse</span><span class="op">(</span><span class="va">lm_immo1</span><span class="op">)</span>  <span class="co"># aus easystats</span></span>
<span><span class="co">## [1] 48589</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im Schnitt liegen wir 4.86^{4} Dollar daneben. Ob das viel oder weniger ist, wird sich im Vergleich mit anderen Modellen zeigen.</p>
<p>R-Quadrat liefert einen anderen Blick auf die Modellgüte:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">lm_immo1</span><span class="op">)</span>  <span class="co"># aus easystats</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.626</span></span>
<span><span class="co">##   adj. R2: 0.625</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Man kann mehrere UV in ein Regressionsmodell aufnehmen. Dazu trennt man sie mit einem Pluszeichen in <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mein_modell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">av</span> <span class="op">~</span> <span class="va">uv1</span> <span class="op">+</span> <span class="va">uv2</span> <span class="op">+</span> <span class="va">...</span> <span class="op">+</span> <span class="va">uv_n</span>, data <span class="op">=</span> <span class="va">meine_daten</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dabei ist das Pluszeichen kein arithmetischer Operator, sondern sagt nur “als UV nimm UV1 und UV2 und …”. Berechnen wir als nächstes ein Modell mit mehreren UV, <code>lm_immo2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_immo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SalePrice</span> <span class="op">~</span> <span class="va">OverallQual</span> <span class="op">+</span> <span class="va">GrLivArea</span> <span class="op">+</span> <span class="va">GarageCars</span>, data <span class="op">=</span> <span class="va">d_train</span><span class="op">)</span></span>
<span><span class="fu">parameters</span><span class="op">(</span><span class="va">lm_immo2</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#tbl-m2-params" class="quarto-xref">Tabelle&nbsp;<span>9.6</span></a> zeigt die Koeffizienten von <code>lm_immo2</code>.</p>
<div class="cell" data-layout-align="center">
<div id="tbl-m2-params" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-m2-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;9.6: Modellparameter von lm_immo2
</figcaption><div aria-describedby="tbl-m2-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Fixed Effects</caption>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-98832.49</td>
</tr>
<tr class="even">
<td style="text-align: left;">OverallQual</td>
<td style="text-align: center;">27104.83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GrLivArea</td>
<td style="text-align: center;">50.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">GarageCars</td>
<td style="text-align: center;">21298.96</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Wie gut sind die Vorhersagen des Modells <code>lm_immo2</code> für die Daten von <code>d_train</code>?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rmse</span><span class="op">(</span><span class="va">lm_immo2</span><span class="op">)</span></span>
<span><span class="co">## [1] 40566</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im Schnitt liegen unsere Vorhersagen 4.06^{4} Dollar daneben. Ist das gut? Betrachten wir noch <span class="math inline">\(R^2\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">lm_immo2</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.739</span></span>
<span><span class="co">##   adj. R2: 0.739</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ob die Modellgüte (R-Quadrat, RMSE, etc.) “gut” bzw. “hoch” ist, beantwortet man am besten <em>relativ</em>, also im Vergleich zu anderen Modellen.</p>
<p>Zum Vergleich berechnen wir das maximal einfache Modell: ohne UV. Man nennt es das <em>Nullmodell</em>. In diesem Modell sagen wir für jedes Haus einfach den mittleren Preis aller Häuser vorher.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SalePrice</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">d_train</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wie gut ist die Vorhersage des Nullnodells?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rmse</span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span>
<span><span class="co">## [1] 79415</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beim Nullmodell liegen wir ca. 80 Tausend Dollar daneben. Das R-Quadrat der Nullmodells ist per Definition null:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">r2</span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span>
<span><span class="co">## # R2 for Linear Regression</span></span>
<span><span class="co">##        R2: 0.000</span></span>
<span><span class="co">##   adj. R2: 0.000</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="vorhersagen-im-test-datensatz-mit-lm_immo2" class="level3" data-number="9.8.6"><h3 data-number="9.8.6" class="anchored" data-anchor-id="vorhersagen-im-test-datensatz-mit-lm_immo2">
<span class="header-section-number">9.8.6</span> Vorhersagen im Test-Datensatz mit <code>lm_immo2</code>
</h3>
<p>Wir haben jetzt unseren Champion, <code>lm_immo2</code>. Alle Hoffnung ruht auf diesem Modell. Ob die Vorhersagen im Test-Sample präzise sein werden? Oder himmelweit daneben? Enttäusche uns nicht! Hier sind die Vorhersagen:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="annotated-cell-36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_immo2_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">lm_immo2</span>, newdata <span class="op">=</span> <span class="va">d_test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lm_immo2_pred</span><span class="op">)</span></span>
<span><span class="co">##      1      2      3      4      5      6 </span></span>
<span><span class="co">## 103395 152441 161838 187676 225467 190260</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl>
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="1" data-code-annotation="1">Erstelle eine Vorhersage anhand der Regressionsgerade von <code>lm_immo1</code> und zwar anhand der Daten aus <code>d_test</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="2" data-code-annotation="2">Zeige den “Kopf” der Vorhersagen (<code>lm_immo1_pred</code>), d.<span class="math inline">\(\,\)</span>h. die ersten paar Vorhersagen.</span>
</dd>
</dl>
</div>
</div>
<p>Die Vorhersagen fügen wir jetzt dem Test-Sample hinzu:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_test</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">d_test</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>SalePrice <span class="op">=</span> <span class="va">lm_immo2_pred</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="einreichen" class="level3" data-number="9.8.7"><h3 data-number="9.8.7" class="anchored" data-anchor-id="einreichen">
<span class="header-section-number">9.8.7</span> Einreichen!</h3>
<p>So, wir haben unsere Vorhersagen! Jetzt reichen wir diese Vorhersagen ein. Für die Prognosedatei (submission file) brauchen wir nur die Spalten <code>id</code> und <code>SalePrice</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_immo2_subm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">d_test</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">Id</span>, <span class="va">SalePrice</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- Kaggle möchte keine fehlenden Werten in den Vorhersagen, also prüfen wir das mal: -->
<!-- ```{r} -->
<!-- #| eval: true -->
<!-- #| code-annotations: hover -->
<!-- lm_immo2_subm %>%  -->
<!--   drop_na() %>%  # <1> -->
<!--   nrow()         # <2> -->
<!-- ``` -->
<!-- 1. Lass alle Zeilen mit NAs (fehlenden Werten in irgendeiner Spalte) fallen, filtere diese Zeilen also raus -->
<!-- 2. Zähle die Anzahl der Zeilen (die noch verbleiben) -->
<!-- Die Anzahl der Zeilen, die wir hier erhalten, ist gleich zu den Anzahl der Zeilen von `d_test`. Es gibt also keine fehlenden Werte. -->
<!-- ```{r} -->
<!-- nrow(d_test) -->
<!-- ``` -->
<!-- #### Vertiefung: Fehlende Werte -->
<!-- Angenommen wir hätten fehlende Werte bei `SalePrice`. -->
<!-- Filtern wir die Spalte `SalePrice` mal nach "ist NA": -->
<!-- ```{r} -->
<!-- m1_subm %>% # <1) -->
<!--   filter(is.na(SalePrice)) # <2> -->
<!-- ``` -->
<!-- Übersetzen wir die Syntax auf Deutsch: -->
<!-- 1. Nimm zuerst die Tabelle `m1_smb` -->
<!-- 2. Filter dann so, dass du nur Zeilen hast, für die gilt, "hier ist ein NA in der Spalte `SalePrice` -->
<!-- Ah, da ist er, der fehlende Wert, in Zeile 2577! -->
<!-- Hinfort! -->
<!-- Wir ersetzen die fehlenden Werte in `SalePrice` mit dem Mittelwert von `SalePrice`: -->
<!-- ```{r} -->
<!-- m1_subm_nona <- # <1> -->
<!--   m1_subm %>%  # <2> -->
<!--   mutate(SalePrice = replace_na(SalePrice, mean(SalePrice, na.rm = TRUE))) # <3> -->
<!-- ``` -->
<!-- Die Syntax wieder auf Deutsch: -->
<!-- 1. Definiere `m1_subm_nona` wie folgt -->
<!-- 2. Nimm `m1_subm` und dann -->
<!-- 3. Verändere die Spalte `SalePrice` und zwar so, dass NAs ersetzt werden durch den Mittelwert von `SalePrice` -->
<!-- Und? Gib es jetzt noch fehlende Werte? -->
<!-- ```{r} -->
<!-- m1_subm_nona %>%  -->
<!--   filter(is.na(SalePrice)) -->
<!-- ``` -->
<!-- Nein! Die Ergebnistabelle hat null Zeilen.  -->
<!-- "No NA" - Keine NAs, keine fehlenden Werte mehr. -->
<p>Diesen Tibble speichern wir als CSV-Datei an geeigneter Stelle ab. Es bietet sich an <code>write_csv</code> zu verwenden, da <code>write.csv</code> automatisch (ungefragt) noch eine Id-Spalte ohne Namen einfügt (mit den Zeilennummern), das mag aber Kaggle nicht. Kaggle erwartet exakt zwei Spalten und zwar mit den Namen <code>Id</code> und <code>SalePrice</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">lm_immo2_subm</span>, <span class="st">"data/ames-kaggle/lm_immo2_subm.csv"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Und dann laden Sie diese Datei, <code>lm2_subm.csv</code> bei Kaggle hoch und hoffen auf einen Hauptgewinn. Das Modell erzielte einen Score von <em>0.55521</em>.</p>
<p>Diese Fallstudie hat ein einfaches Prognosemodell vorgestellt. Sicherlich gibt es viele Ansätze, dieses Modell zu verbessern. Hier sind einige Fragen, die Sie sich dazu stellen können:</p>
<ul>
<li>Welche UV sollte ich in das Modell aufnehmen?</li>
<li>Wie gehe ich mit fehlenden Werten um?</li>
<li>Wenn eine UV schief ist, sollte ich ihn dann log-transformieren?</li>
<li>Vielleicht sollte man manche UV quadrieren?</li>
<li>Wie gehe ich mit nominalskalierten Variablen um, wenn diese viele Stufen haben?</li>
<li>…</li>
</ul>
<p>Viel Spielraum für Ihre Kreativität!</p>
<!-- ## Fazit -->
<!-- TODO  -->
</section></section><section id="aufgaben" class="level2" data-number="9.9"><h2 data-number="9.9" class="anchored" data-anchor-id="aufgaben">
<span class="header-section-number">9.9</span> Aufgaben</h2>
<p>Die Webseite <a href="https://datenwerk.netlify.app">datenwerk.netlify.app</a> stellt eine Reihe von einschlägigen Übungsaufgaben bereit. Sie können die Suchfunktion der Webseite nutzen, um die Aufgaben mit den folgenden Namen zu suchen:</p>
<ul>
<li>Aussagen-einfache-Regr</li>
<li>interpret-koeff-lm</li>
<li>korr-als-regr</li>
<li>Linearitaet1a</li>
<li>lm1</li>
<li>mtcars-regr01</li>
<li>nichtlineare-regr1</li>
<li>penguins-regr02</li>
<li>regression1</li>
<li>regression1b</li>
<li>Regression3</li>
<li>Regression4</li>
<li>Regression5</li>
<li>Regression6</li>
<li>ames-kaggle1</li>
</ul>
<p>Schauen Sie sich auch weitere Aufgaben des <a href="https://sebastiansauer.github.io/Datenwerk/">Datenwerks</a> an, vor allem mit den Tags <a href="https://sebastiansauer.github.io/Datenwerk/#category=regression">regression</a> und <a href="https://sebastiansauer.github.io/Datenwerk/#category=lm">lm</a>.</p>
<p><em>Nicht alle Aufgaben</em> aus dieser Sammlung passen zum Stoff dieses Kapitels; vielleicht können Sie einige Aufgaben nicht lösen. Ignorieren Sie einfach diese Aufgaben.</p>
</section><section id="literaturhinweise" class="level2" data-number="9.10"><h2 data-number="9.10" class="anchored" data-anchor-id="literaturhinweise">
<span class="header-section-number">9.10</span> Literaturhinweise</h2>
<p><span class="citation" data-cites="gelman_regression_2021">Gelman et al. (<a href="references.html#ref-gelman_regression_2021" role="doc-biblioref">2021</a>)</span> liefert eine deutlich umfassendere Einführung in die Regressionsanalyse als dieses Kapitel es tut. Eine moderne, R-orientierte Einführung in Statistik inklusive der Regressionsanalyse findet sich bei <span class="citation" data-cites="cetinkaya-rundel_introduction_2021">Çetinkaya-Runde &amp; Hardin (<a href="references.html#ref-cetinkaya-rundel_introduction_2021" role="doc-biblioref">2021</a>)</span>. Ein Klassiker mit viel Aha-Potenzial ist <span class="citation" data-cites="cohen_applied_2003">Cohen et al. (<a href="references.html#ref-cohen_applied_2003" role="doc-biblioref">2003</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-cetinkaya-rundel_introduction_2021" class="csl-entry" role="listitem">
Çetinkaya-Runde, M., &amp; Hardin, J. (2021). <em>Introduction to <span>Modern Statistics</span></em>. <a href="https://openintro-ims.netlify.app/">https://openintro-ims.netlify.app/</a>
</div>
<div id="ref-cohen_applied_2003" class="csl-entry" role="listitem">
Cohen, J., Cohen, P., West, S. G., &amp; Aiken, L. S. (2003). <em>Applied Multiple Regression/Correlation Analysis for the Behavioral Sciences, 3rd Ed</em>. Lawrence Erlbaum.
</div>
<div id="ref-gelman_regression_2021" class="csl-entry" role="listitem">
Gelman, A., Hill, J., &amp; Vehtari, A. (2021). <em>Regression and Other Stories</em>. Cambridge University Press.
</div>
<div id="ref-kaplan_statistical_2009" class="csl-entry" role="listitem">
Kaplan, D. T. (2009). <em>Statistical Modeling: A Fresh Approach</em>. CreateSpace. <a href="https://dtkaplan.github.io/SM2-bookdown/">https://dtkaplan.github.io/SM2-bookdown/</a>
</div>
<div id="ref-menk_linear_2014" class="csl-entry" role="listitem">
Menk. (2014, Juli 29). <em>Linear Regression [Computer Code]</em>. <a href="https://texample.net/tikz/examples/linear-regression/">https://texample.net/tikz/examples/linear-regression/</a>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p><a href="https://raw.githubusercontent.com/sebastiansauer/statistik1/main/data/noten.csv" class="uri">https://raw.githubusercontent.com/sebastiansauer/statistik1/main/data/noten.csv</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://fomshinyapps.shinyapps.io/KleinsteQuadrate/" class="uri">https://fomshinyapps.shinyapps.io/KleinsteQuadrate/</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJlc2V0QnV0dG9uID0ge1xuICBjb25zdCByZXNldEJ1dHRvbiA9IElucHV0cy5idXR0b24oXCJSZXNldFwiKTtcblxuICBkMy5zZWxlY3QocmVzZXRCdXR0b24pLm9uKFwiaW5wdXRcIiwgKCkgPT4ge1xuXG4gICAgcmVncmVzc2lvblBsb3QucmVzZXQoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc2V0QnV0dG9uO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld09wdGlvbnMgPSB7XG4gIGNvbnN0IHZpZXdPcHRpb25zID0gSW5wdXRzLnJhZGlvKFxuICAgIFtcIk5vbmVcIiwgXCJBYnNvbHV0ZSBFcnJvclwiLCBcIlNxdWFyZWQgRXJyb3JcIl0sXG4gICAgeyBsYWJlbDogXCJWaWV3XCIsIHZhbHVlOiBcIkFic29sdXRlIEVycm9yXCIgfVxuICApO1xuXG4gIGQzLnNlbGVjdCh2aWV3T3B0aW9ucykub24oXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgcmVncmVzc2lvblBsb3QudXBkYXRlVmlldyh2aWV3T3B0aW9ucy52YWx1ZSk7XG4gIH0pO1xuXG4gIHJldHVybiB2aWV3T3B0aW9ucztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InJTcXVhcmVkUGxvdCA9IFJTcXVhcmVkUGxvdCh7IHdpZHRoOiB3aWR0aCB9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVncmVzc2lvblBsb3QgPSB7XG4gIGNvbnN0IHJlZ3Jlc3Npb25QbG90ID0gUmVncmVzc2lvblBsb3QoZGF0YS5zbGljZSgwLCAxKSwge1xuICAgIHdpZHRoOiB3aWR0aCxcbiAgICB4RG9tYWluOiBbMCwgZDMubWF4KGRhdGEsIChbeF0pID0+IHgpICsgNV0sXG4gICAgeURvbWFpbjogWzAsIGQzLm1heChkYXRhLCAoW18sIHldKSA9PiB5KSArIDVdLFxuICAgIHI6IDYsXG4gICAgc2hvd0dyaWQ6IHRydWVcbiAgfSk7XG4gIC8vIEF0dGFjaCBsaXN0ZW5lclxuICBkMy5zZWxlY3QocmVncmVzc2lvblBsb3QpLm9uKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgIHJTcXVhcmVkUGxvdC51cGRhdGUodGhpcy52YWx1ZSwgdGhpcy50cmFuc2l0aW9uKTtcbiAgfSk7XG5cbiAgclNxdWFyZWRQbG90LnVwZGF0ZShyZWdyZXNzaW9uUGxvdC52YWx1ZSk7XG5cbiAgcmV0dXJuIHJlZ3Jlc3Npb25QbG90O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoid2lkdGggPSA4MDBcbmRhdGEgPSB7XG4gIGNvbnN0IG51bVBvaW50cyA9IDE1O1xuICBjb25zdCB4U2NhbGUgPSAxMDtcbiAgY29uc3QgeFNoaWZ0ID0gNTtcbiAgY29uc3QgeVNjYWxlID0gNjtcbiAgY29uc3QgeVNoaWZ0ID0gMDtcblxuICBjb25zdCBkYXRhID0gZDMucmFuZ2UobnVtUG9pbnRzKS5tYXAoKGkpID0+IHtcbiAgICBjb25zdCB4Q29vcmQgPSB4U2hpZnQgKyB4U2NhbGUgKiBkMy5yYW5kb21Vbmlmb3JtKCkoKTtcbiAgICBjb25zdCB5Q29vcmQgPSB5U2hpZnQgKyB4Q29vcmQgKyB5U2NhbGUgKiBkMy5yYW5kb21Vbmlmb3JtKCkoKTtcblxuICAgIHJldHVybiBbeENvb3JkLCB5Q29vcmRdO1xuICB9KTtcblxuICByZXR1cm4gZGF0YTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFuaW1hdGlvbiA9IHtcbiAgLy8gUGVyZm9ybSBvcGVuaW5nIGFuaW1hdGlvblxuICBjb25zdCB0b3RhbFRpbWUgPSA2XzAwMDtcbiAgY29uc3QgZWFzZSA9IGQzLmVhc2VRdWFkT3V0O1xuXG4gIGQzLnJhbmdlKDEsIGRhdGEubGVuZ3RoKS5mb3JFYWNoKChpKSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBbeENvb3JkLCB5Q29vcmRdID0gZGF0YVtpXTtcblxuICAgICAgcmVncmVzc2lvblBsb3QudXBkYXRlRGF0YXBvaW50KHhDb29yZCwgeUNvb3JkKTtcbiAgICB9LCB0b3RhbFRpbWUgKiBlYXNlKGkgLyBkYXRhLmxlbmd0aCkpO1xuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIFJTcXVhcmVkUGxvdCh7XG4gIGRhdGEsXG4gIG1hcmdpblRvcCA9IDAsIC8vIHRvcCBtYXJnaW4sIGluIHBpeGVsc1xuICBtYXJnaW5SaWdodCA9IDMwLCAvLyByaWdodCBtYXJnaW4sIGluIHBpeGVsc1xuICBtYXJnaW5Cb3R0b20gPSAwLCAvLyBib3R0b20gbWFyZ2luLCBpbiBwaXhlbHNcbiAgbWFyZ2luTGVmdCA9IDUzLCAvLyBsZWZ0IG1hcmdpbiwgaW4gcGl4ZWxzXG4gIHdpZHRoID0gNjQwLCAvLyBvdXRlciB3aWR0aCwgaW4gcGl4ZWxzXG4gIGhlaWdodCA9IDIwLCAvLyBvdXRlciBoZWlnaHQsIGluIHBpeGVsc1xuICBiYXJIZWlnaHQgPSAyNSwgLy8gaGVpZ2h0IG9mIGJhciwgaW4gcGl4ZWxzXG4gIHRpdGxlU2l6ZSA9IDIwLCAvLyBmb250c2l6ZSBvZiB0aXRsZSB0ZXh0XG4gIGxhYmVsU2l6ZSA9IDEyIC8vIGZvbnRzaXplIG9mIGxhYmVsIHRleHRcbn0gPSB7fSkge1xuICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSBkYXRhID0gMDtcblxuICBjb25zdCB4U2NhbGUgPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMV0pXG4gICAgLnJhbmdlKFttYXJnaW5MZWZ0LCB3aWR0aCAtIG1hcmdpblJpZ2h0XSk7XG5cbiAgY29uc3Qgc3ZnID0gZDNcbiAgICAuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKTtcblxuICAvLyBEcmF3IHRpdGxlLlxuICBjb25zdCB0aXRsZUdyb3VwID0gc3ZnLmFwcGVuZChcImdcIik7XG5cbiAgLy8gdGl0bGVHcm91cFxuICAvLyAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gIC8vICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAvLyAgIC5hdHRyKFwieDFcIiwgeFNjYWxlKDApKVxuICAvLyAgIC5hdHRyKFwieDJcIiwgeFNjYWxlKDApKVxuICAvLyAgIC5hdHRyKFwieTFcIiwgMClcbiAgLy8gICAuYXR0cihcInkyXCIsIGhlaWdodCk7XG5cbiAgdGl0bGVHcm91cFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXG4gICAgLmF0dHIoXCJkb21pbmFudC1iYXNlbGluZVwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJzZXJpZlwiKVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIHRpdGxlU2l6ZSlcbiAgICAuYXR0cihcInhcIiwgeFNjYWxlKDApKVxuICAgIC5hdHRyKFwiZHhcIiwgLTEwKVxuICAgIC5hdHRyKFwieVwiLCBoZWlnaHQgLyAyKVxuICAgIC50ZXh0KFwiUsKyXCIpO1xuXG4gIC8vIERyYXcgd2hvbGUgYmFyLlxuICBzdmdcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwiZ2FpbnNib3JvXCIpXG4gICAgLmF0dHIoXCJ4XCIsIHhTY2FsZSgwKSlcbiAgICAuYXR0cihcInlcIiwgbWFyZ2luVG9wKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggLSBtYXJnaW5MZWZ0IC0gbWFyZ2luUmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0IC0gbWFyZ2luVG9wIC0gbWFyZ2luQm90dG9tKTtcblxuICAvLyBEcmF3IGJhci5cbiAgY29uc3QgYmFyID0gdXBkYXRlQmFyKHN2Zy5hcHBlbmQoXCJnXCIpLnNlbGVjdEFsbChcInJlY3RcIiksIDApO1xuXG4gIC8vIERyYXcgbGFiZWxcbiAgY29uc3QgbGFiZWxGb3JtYXQgPSBkMy5mb3JtYXQoXCIuMmZcIik7XG4gIGNvbnN0IGxhYmVsID0gdXBkYXRlTGFiZWwoc3ZnLmFwcGVuZChcImdcIikuc2VsZWN0QWxsKFwidGV4dFwiKSwgMCk7XG5cbiAgLy8gVXBkYXRlIGFjY29yZGluZyB0byBkYXRhLlxuICB1cGRhdGUoZGF0YSk7XG5cbiAgZnVuY3Rpb24gdXBkYXRlQmFyKHJlY3QsIGRhdGEsIHRyYW5zaXRpb24gPSB0cnVlKSB7XG4gICAgcmV0dXJuIHJlY3QuZGF0YShbZGF0YV0pLmpvaW4oXG4gICAgICAoZW50ZXIpID0+XG4gICAgICAgIGVudGVyXG4gICAgICAgICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKVxuICAgICAgICAgIC5hdHRyKFwieFwiLCB4U2NhbGUoMCkpXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIG1hcmdpblRvcClcbiAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIDApXG4gICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0IC0gbWFyZ2luVG9wIC0gbWFyZ2luQm90dG9tKSxcbiAgICAgICh1cGRhdGUpID0+XG4gICAgICAgIHVwZGF0ZS5jYWxsKCh1cGRhdGUpID0+IHtcbiAgICAgICAgICBpZiAodHJhbnNpdGlvbikgdXBkYXRlID0gdXBkYXRlLnRyYW5zaXRpb24oKTtcblxuICAgICAgICAgIHVwZGF0ZS5hdHRyKFwid2lkdGhcIiwgKGQpID0+IHhTY2FsZShpc05hTihkKSA/IDAgOiBkKSAtIHhTY2FsZSgwKSk7XG4gICAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxhYmVsKHRleHQsIGRhdGEsIHRyYW5zaXRpb24gPSB0cnVlKSB7XG4gICAgcmV0dXJuIHRleHQuZGF0YShbZGF0YV0pLmpvaW4oXG4gICAgICAoZW50ZXIpID0+XG4gICAgICAgIGVudGVyXG4gICAgICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAuYXR0cihcImRvbWluYW50LWJhc2VsaW5lXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBsYWJlbFNpemUpXG4gICAgICAgICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKVxuICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgICAgICAgIC5hdHRyKFwiZHhcIiwgMTApXG4gICAgICAgICAgLmF0dHIoXCJ4XCIsIHhTY2FsZSgwKSlcbiAgICAgICAgICAuYXR0cihcInlcIiwgaGVpZ2h0IC8gMilcbiAgICAgICAgICAudGV4dChsYWJlbEZvcm1hdChcIjBcIikpLFxuICAgICAgKHVwZGF0ZSkgPT5cbiAgICAgICAgdXBkYXRlLmNhbGwoKHVwZGF0ZSkgPT4ge1xuICAgICAgICAgIC8vIENoZWNrIGlmIGJhciBpcyB0b28gc2hvcnRcbiAgICAgICAgICBjb25zdCBjaGVjayA9IChkKSA9PiBkIDwgMC4xO1xuXG4gICAgICAgICAgaWYgKHRyYW5zaXRpb24pIHVwZGF0ZSA9IHVwZGF0ZS50cmFuc2l0aW9uKCk7XG5cbiAgICAgICAgICB1cGRhdGVcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCAoZCkgPT4geFNjYWxlKGQpKVxuICAgICAgICAgICAgLnRleHQoKGQpID0+IGxhYmVsRm9ybWF0KGQpKVxuICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIChkKSA9PiAoY2hlY2soZCkgPyBcImJsYWNrXCIgOiBcIndoaXRlXCIpKVxuICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCAoZCkgPT4gKGNoZWNrKGQpID8gXCJzdGFydFwiIDogXCJlbmRcIikpXG4gICAgICAgICAgICAuYXR0cihcImR4XCIsIChkKSA9PiAoY2hlY2soZCkgPyAxMCA6IC0xMCkpO1xuICAgICAgICB9KVxuICAgICk7XG4gIH1cblxuICAvLyBNYWluIGZ1bmN0aW9uIGZvciBkYXRhIHVwZGF0ZXMuXG4gIGZ1bmN0aW9uIHVwZGF0ZShkYXRhLCB0cmFuc2l0aW9uID0gdHJ1ZSkge1xuICAgIHVwZGF0ZUJhcihiYXIsIGRhdGEsIHRyYW5zaXRpb24pO1xuICAgIHVwZGF0ZUxhYmVsKGxhYmVsLCBkYXRhLCB0cmFuc2l0aW9uKTtcbiAgfVxuXG4gIHJldHVybiBPYmplY3QuYXNzaWduKHN2Zy5ub2RlKCksIHsgdXBkYXRlIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdG8gZHJhdyBsaW5lcyBhdCB0aGUgb3JpZ2luICh0byBzaG93IGludGVyY2VwdCBhbmQgc3R1ZmYpXG4vLyBjcmVhdGUgdm9yb25vaSBvdmVybGF5PyBmb3IgZHJhZ2dpbmcgcG9pbnRzXG4vLyB2aXogZXJyb3IgLyBzcXVhcmVkIGVycm9yXG4vLyBtYWtlIHRoZSBlcnJvciBsaW5lcyBsb29rIGxpa2UgYSB3ZWlnaHRcbi8vIHNob3cgb3RoZXIgbWV0cmljcyBsaWtlIFJeMiBldGMuXG5mdW5jdGlvbiBSZWdyZXNzaW9uUGxvdChcbiAgZGF0YSxcbiAge1xuICAgIHggPSAoW3hdKSA9PiB4LCAvLyBhY2Nlc3NvciBmdW5jdGlvbiBmb3IgeC1jb29yZGluYXRlXG4gICAgeSA9IChbLCB5XSkgPT4geSwgLy8gYWNjZXNzb3IgZnVuY3Rpb24gZm9yIHktY29vcmRpbmF0ZVxuICAgIHIgPSA2LCAvLyByYWRpdXMgb2YgZG90cywgaW4gcGl4ZWxzXG4gICAgbWFyZ2luVG9wID0gMjAsIC8vIHRvcCBtYXJnaW4sIGluIHBpeGVsc1xuICAgIG1hcmdpblJpZ2h0ID0gMzAsIC8vIHJpZ2h0IG1hcmdpbiwgaW4gcGl4ZWxzXG4gICAgbWFyZ2luQm90dG9tID0gMzAsIC8vIGJvdHRvbSBtYXJnaW4sIGluIHBpeGVsc1xuICAgIG1hcmdpbkxlZnQgPSA0MCwgLy8gbGVmdCBtYXJnaW4sIGluIHBpeGVsc1xuICAgIGluc2V0ID0gciAqIDIsIC8vIGluc2V0IHRoZSBkZWZhdWx0IHJhbmdlLCBpbiBwaXhlbHNcbiAgICBpbnNldFRvcCA9IGluc2V0LCAvLyBpbnNldCB0aGUgZGVmYXVsdCB5LXJhbmdlXG4gICAgaW5zZXRSaWdodCA9IGluc2V0LCAvLyBpbnNldCB0aGUgZGVmYXVsdCB4LXJhbmdlXG4gICAgaW5zZXRCb3R0b20gPSBpbnNldCwgLy8gaW5zZXQgdGhlIGRlZmF1bHQgeS1yYW5nZVxuICAgIGluc2V0TGVmdCA9IGluc2V0LCAvLyBpbnNldCB0aGUgZGVmYXVsdCB4LXJhbmdlXG4gICAgd2lkdGggPSA2NDAsIC8vIG91dGVyIHdpZHRoLCBpbiBwaXhlbHNcbiAgICBoZWlnaHQgPSA1MDAsIC8vIG91dGVyIGhlaWdodCwgaW4gcGl4ZWxzXG4gICAgeFR5cGUgPSBkMy5zY2FsZUxpbmVhciwgLy8gdHlwZSBvZiB4LXNjYWxlXG4gICAgeERvbWFpbiwgLy8gW3htaW4sIHhtYXhdXG4gICAgeFJhbmdlID0gW21hcmdpbkxlZnQgKyBpbnNldExlZnQsIHdpZHRoIC0gbWFyZ2luUmlnaHQgLSBpbnNldFJpZ2h0XSwgLy8gW2xlZnQsIHJpZ2h0XVxuICAgIHlUeXBlID0gZDMuc2NhbGVMaW5lYXIsIC8vIHR5cGUgb2YgeS1zY2FsZVxuICAgIHlEb21haW4sIC8vIFt5bWluLCB5bWF4XVxuICAgIHlSYW5nZSA9IFtoZWlnaHQgLSBtYXJnaW5Cb3R0b20gLSBpbnNldEJvdHRvbSwgbWFyZ2luVG9wICsgaW5zZXRUb3BdLCAvLyBbYm90dG9tLCB0b3BdXG4gICAgc2hvd0dyaWQgPSB0cnVlIC8vIHdoZXRoZXIgdG8gc2hvdyBncmlkIGxpbmVzXG4gIH0gPSB7fVxuKSB7XG4gIGNvbnN0IGVycm9yQ29sb3IgPSBkMy5zY2hlbWVTZXQzWzNdO1xuXG4gIGxldCBlcnJvckxpbmVzT3BhY2l0eSA9IDE7XG4gIGxldCBlcnJvclNxdWFyZXNPcGFjaXR5ID0gMDtcblxuICAvLyBJbml0IGRyYWcgb2JqZWN0LlxuICBjb25zdCBkcmFnID0gZDNcbiAgICAuZHJhZygpXG4gICAgLy8gLm9uKFwic3RhcnRcIiwgZHJhZ3N0YXJ0ZWQpXG4gICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKTtcbiAgLy8gLm9uKFwiZW5kXCIsIGRyYWdlbmRlZCk7XG5cbiAgLy8gVG8gZ2l2ZSBlYWNoIGRhdGEgcG9pbnQgYSB1bmlxdWUgaWRcbiAgbGV0IGlkQ291bnRlciA9IDA7XG5cbiAgLy8gQ29tcHV0ZSBkYXRhIHZhbHVlcy5cbiAgZGF0YSA9IGRhdGEubWFwKChkKSA9PiAoe1xuICAgIHhDb29yZDogeChkKSxcbiAgICB5Q29vcmQ6IHkoZCksXG4gICAgaWQ6IGlkQ291bnRlcisrXG4gIH0pKTtcblxuICAvLyBTdG9yZSBjb3B5IG9mIGluaXRpYWwgZGF0YSBvYmplY3RcbiAgY29uc3QgaW5pdERhdGEgPSBkYXRhLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XG5cbiAgLy8gQ29tcHV0ZSBkZWZhdWx0IGRvbWFpbnMuXG4gIC8vIGlmICh4RG9tYWluID09PSB1bmRlZmluZWQpIHhEb21haW4gPSBkMy5leHRlbnQoZGF0YSwgKGQpID0+IGQueENvb3JkKTtcbiAgaWYgKHhEb21haW4gPT09IHVuZGVmaW5lZCkgeERvbWFpbiA9IFswLCBkMy5tYXgoZGF0YSwgKGQpID0+IGQueENvb3JkKV07XG4gIGlmICh5RG9tYWluID09PSB1bmRlZmluZWQpIHlEb21haW4gPSBbMCwgZDMubWF4KGRhdGEsIChkKSA9PiBkLnlDb29yZCldO1xuXG4gIC8vIEluaXQgbGluZWFyIHJlZ3Jlc3Nvci5cbiAgY29uc3QgbGluZWFyUmVncmVzc2lvbiA9IGQzXG4gICAgLnJlZ3Jlc3Npb25MaW5lYXIoKVxuICAgIC54KChkKSA9PiBkLnhDb29yZClcbiAgICAueSgoZCkgPT4gZC55Q29vcmQpXG4gICAgLmRvbWFpbih4RG9tYWluKTtcblxuICAvLyBDb25zdHJ1Y3Qgc2NhbGVzIGFuZCBheGVzLlxuICBjb25zdCB4U2NhbGUgPSB4VHlwZSh4RG9tYWluLCB4UmFuZ2UpO1xuICBjb25zdCB5U2NhbGUgPSB5VHlwZSh5RG9tYWluLCB5UmFuZ2UpO1xuICBjb25zdCB4QXhpcyA9IGQzLmF4aXNCb3R0b20oeFNjYWxlKS50aWNrcyh3aWR0aCAvIDgwKTtcbiAgY29uc3QgeUF4aXMgPSBkMy5heGlzTGVmdCh5U2NhbGUpLnRpY2tzKGhlaWdodCAvIDgwKTtcblxuICAvLyBEcmF3IHN2Zy5cbiAgY29uc3Qgc3ZnID0gZDNcbiAgICAuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKTtcblxuICAvLyBEcmF3IHhBeGlzLlxuICBjb25zdCBheGlzT3BhY2l0eSA9IDE7XG5cbiAgY29uc3QgeEdyb3VwID0gc3ZnXG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDAsJHtoZWlnaHQgLSBtYXJnaW5Cb3R0b219KWApXG4gICAgLmF0dHIoXCJvcGFjaXR5XCIsIGF4aXNPcGFjaXR5KVxuICAgIC5jYWxsKHhBeGlzKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdChcIi5kb21haW5cIikucmVtb3ZlKCkpO1xuICAvLyBEcmF3IGdyaWQgbGluZXNcbiAgeEdyb3VwXG4gICAgLnNlbGVjdEFsbChcIi50aWNrIGxpbmVcIilcbiAgICAuY2xvbmUoKVxuICAgIC5hdHRyKFwieTJcIiwgbWFyZ2luVG9wICsgbWFyZ2luQm90dG9tIC0gaGVpZ2h0KVxuICAgIC8vIERyYXcgbGluZSBhdCBvcmlnaW5cbiAgICAuYXR0cihcInN0cm9rZS1vcGFjaXR5XCIsIChkKSA9PiB7XG4gICAgICBpZiAoZCA9PSAwKSB7XG4gICAgICAgIHJldHVybiBheGlzT3BhY2l0eTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBzaG93R3JpZCA/IDAuMSA6IDA7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgLy8gRHJhdyB5QXhpcy5cbiAgY29uc3QgeUdyb3VwID0gc3ZnXG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luTGVmdH0sMClgKVxuICAgIC5hdHRyKFwib3BhY2l0eVwiLCBheGlzT3BhY2l0eSlcbiAgICAuY2FsbCh5QXhpcylcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3QoXCIuZG9tYWluXCIpLnJlbW92ZSgpKTtcbiAgeUdyb3VwXG4gICAgLnNlbGVjdEFsbChcIi50aWNrIGxpbmVcIilcbiAgICAuY2xvbmUoKVxuICAgIC5hdHRyKFwieDJcIiwgd2lkdGggLSBtYXJnaW5MZWZ0IC0gbWFyZ2luUmlnaHQpXG4gICAgLy8gRHJhdyBsaW5lIGF0IG9yaWdpblxuICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgKGQpID0+IHtcbiAgICAgIGlmIChkID09IDApIHtcbiAgICAgICAgcmV0dXJuIGF4aXNPcGFjaXR5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHNob3dHcmlkID8gMC4xIDogMDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAvLyBEcmF3IGVycm9yIHNxdWFyZXMuXG4gIGxldCBlcnJvclNxdWFyZXMgPSB1cGRhdGVFcnJvclNxdWFyZXMoXG4gICAgc3ZnLmFwcGVuZChcImdcIikuc2VsZWN0QWxsKFwicmVjdFwiKSxcbiAgICBkYXRhXG4gICk7XG5cbiAgLy8gRHJhdyBlcnJvciBsaW5lcy5cbiAgbGV0IGVycm9yTGluZXMgPSB1cGRhdGVFcnJvckxpbmVzKHN2Zy5hcHBlbmQoXCJnXCIpLnNlbGVjdEFsbChcImxpbmVcIiksIGRhdGEpO1xuXG4gIC8vIERyYXcgcmVncmVzc2lvbiBsaW5lLlxuICBjb25zdCByZWdyZXNzaW9uTGluZUdyb3VwID0gc3ZnXG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMik7XG4gIC8vIC5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLCBcIjIwLDIwXCIpO1xuXG4gIGNvbnN0IHJlZ3Jlc3Npb25MaW5lID0gdXBkYXRlUmVncmVzc2lvbkxpbmUoXG4gICAgcmVncmVzc2lvbkxpbmVHcm91cC5zZWxlY3RBbGwoXCJsaW5lXCIpLFxuICAgIGRhdGFcbiAgKTtcblxuICAvLyBEcmF3IHNwYWNlIGZvciBwbG90IGludGVyYWN0aW9ucy5cbiAgY29uc3QgcGxvdFJlY3QgPSBzdmdcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KVxuICAgIC5hdHRyKFwib3BhY2l0eVwiLCAwKVxuICAgIC5vbihcImNsaWNrXCIsIGFkZERhdGFwb2ludCk7XG5cbiAgLy8gRHJhdyBkYXRhIHBvaW50cy5cbiAgY29uc3QgY2lyY2xlc0dyb3VwID0gc3ZnLmFwcGVuZChcImdcIikuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKTtcbiAgbGV0IGNpcmNsZXMgPSB1cGRhdGVDaXJjbGVzKGNpcmNsZXNHcm91cC5zZWxlY3RBbGwoXCJjaXJjbGVcIiksIGRhdGEpO1xuXG4gIC8vIERyYWcgaW50ZXJhY3Rpb25zIGZvciBjaXJjbGVzLlxuICBmdW5jdGlvbiBkcmFnc3RhcnRlZChldmVudCwgZCkge1xuICAgIGQzLnNlbGVjdCh0aGlzKS5yYWlzZSgpLmF0dHIoXCJzdHJva2VcIiwgXCJyZWRcIik7XG4gIH1cbiAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCwgZCkge1xuICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgLy8gVXBkYXRlIGRhdGEgcG9pbnQsIGFzIHdlbGwgYXMgaXRzIHBvc2l0aW9uIG9uIHRoZSBwbG90XG4gICAgICAuYXR0cihcImN4XCIsICgpID0+IHtcbiAgICAgICAgZC54Q29vcmQgPSB4U2NhbGUuaW52ZXJ0KGV2ZW50LngpO1xuICAgICAgICByZXR1cm4gZXZlbnQueDtcbiAgICAgIH0pXG4gICAgICAuYXR0cihcImN5XCIsICgpID0+IHtcbiAgICAgICAgZC55Q29vcmQgPSB5U2NhbGUuaW52ZXJ0KGV2ZW50LnkpO1xuICAgICAgICByZXR1cm4gZXZlbnQueTtcbiAgICAgIH0pO1xuXG4gICAgdXBkYXRlUmVncmVzc2lvbkxpbmUocmVncmVzc2lvbkxpbmUsIGRhdGEsIGZhbHNlKTtcbiAgICBlcnJvclNxdWFyZXMgPSB1cGRhdGVFcnJvclNxdWFyZXMoZXJyb3JTcXVhcmVzLCBkYXRhLCBmYWxzZSk7XG4gICAgZXJyb3JMaW5lcyA9IHVwZGF0ZUVycm9yTGluZXMoZXJyb3JMaW5lcywgZGF0YSwgZmFsc2UpO1xuICB9XG4gIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCwgaSkge1xuICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwic3Ryb2tlXCIsIG51bGwpO1xuICB9XG5cbiAgLy8gQ2xpY2sgaW50ZXJhY3Rpb24gZm9yIGNpcmNsZXMuXG4gIGZ1bmN0aW9uIHJlbW92ZURhdGFwb2ludChldmVudCwgZEN1cnIpIHtcbiAgICBpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuOyAvLyBkcmFnZ2VkXG5cbiAgICAvLyBSZW1vdmUgZGF0YSBwb2ludDsgZmFzdGVyIHdheSB0byBkbyB0aGlzP1xuICAgIGRhdGEgPSBkYXRhLmZpbHRlcigoZCkgPT4gZC5pZCAhPT0gZEN1cnIuaWQpO1xuXG4gICAgdXBkYXRlKGRhdGEpO1xuICB9XG5cbiAgLy8gQ2xpY2sgaW50ZXJhY3Rpb24gZm9yIHBsb3QuXG4gIGZ1bmN0aW9uIGFkZERhdGFwb2ludChldmVudCkge1xuICAgIGNvbnN0IFt4bSwgeW1dID0gZDMucG9pbnRlcihldmVudCk7XG5cbiAgICB1cGRhdGVEYXRhcG9pbnQoeFNjYWxlLmludmVydCh4bSksIHlTY2FsZS5pbnZlcnQoeW0pKTtcbiAgfVxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiBmb3IgcmVncmVzc2lvbiBsaW5lIHVwZGF0ZS5cbiAgZnVuY3Rpb24gdXBkYXRlUmVncmVzc2lvbkxpbmUobGluZSwgZGF0YSwgdHJhbnNpdGlvbiA9IHRydWUpIHtcbiAgICBjb25zdCByZWdyZXNzaW9uRGF0YSA9IGxpbmVhclJlZ3Jlc3Npb24oZGF0YSk7XG5cbiAgICAvLyBEaXNwYXRjaCBldmVudCBhbmQgUl4yIHZhbHVlXG4gICAgc3ZnLm5vZGUoKS52YWx1ZSA9IHJlZ3Jlc3Npb25EYXRhLnJTcXVhcmVkO1xuICAgIHN2Zy5ub2RlKCkudHJhbnNpdGlvbiA9IHRyYW5zaXRpb247XG4gICAgc3ZnLmRpc3BhdGNoKFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pO1xuXG4gICAgcmV0dXJuIGxpbmVcbiAgICAgIC5kYXRhKFtyZWdyZXNzaW9uRGF0YV0pXG4gICAgICAuam9pbihcImxpbmVcIilcbiAgICAgIC5jYWxsKChsaW5lKSA9PiB7XG4gICAgICAgIGlmICh0cmFuc2l0aW9uKSBsaW5lID0gbGluZS50cmFuc2l0aW9uKCk7XG4gICAgICAgIGxpbmVcbiAgICAgICAgICAuYXR0cihcIngxXCIsIChkKSA9PiB4U2NhbGUoZFswXVswXSkpXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCAoZCkgPT4geFNjYWxlKGRbMV1bMF0pKVxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgKGQpID0+IHlTY2FsZShkWzBdWzFdKSlcbiAgICAgICAgICAuYXR0cihcInkyXCIsIChkKSA9PiB5U2NhbGUoZFsxXVsxXSkpO1xuICAgICAgfSk7XG4gIH1cblxuICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gdXBkYXRlIGNpcmNsZXMgYmFzZWQgb24gbmV3IGRhdGEuXG4gIGZ1bmN0aW9uIHVwZGF0ZUNpcmNsZXMoY2lyY2xlcywgZGF0YSkge1xuICAgIHJldHVybiBjaXJjbGVzXG4gICAgICAuZGF0YShkYXRhLCAoZCkgPT4gZC5pZClcbiAgICAgIC5qb2luKFxuICAgICAgICAoZW50ZXIpID0+XG4gICAgICAgICAgZW50ZXJcbiAgICAgICAgICAgIC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgKGQpID0+IHhTY2FsZShkLnhDb29yZCkpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIChkKSA9PiB5U2NhbGUoZC55Q29vcmQpKVxuICAgICAgICAgICAgLy8gVG8gdHJhbnNpdGlvbiBmcm9tIDAgcmFkaXVzXG4gICAgICAgICAgICAuYXR0cihcInJcIiwgMClcbiAgICAgICAgICAgIC8vIEF0dGFjaCBpbnRlcmFjdGlvbnNcbiAgICAgICAgICAgIC5jYWxsKGRyYWcpXG4gICAgICAgICAgICAub24oXCJjbGlja1wiLCByZW1vdmVEYXRhcG9pbnQpXG4gICAgICAgICAgICAvLyBBZGQgdHJhbnNpdGlvblxuICAgICAgICAgICAgLmNhbGwoKGVudGVyKSA9PlxuICAgICAgICAgICAgICBlbnRlclxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAuZWFzZShkMy5lYXNlQmFja091dC5vdmVyc2hvb3QoMS43KSlcbiAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgcilcbiAgICAgICAgICAgICksXG4gICAgICAgICh1cGRhdGUpID0+XG4gICAgICAgICAgdXBkYXRlXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIChkKSA9PiB4U2NhbGUoZC54Q29vcmQpKVxuICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCAoZCkgPT4geVNjYWxlKGQueUNvb3JkKSksXG4gICAgICAgIChleGl0KSA9PlxuICAgICAgICAgIGV4aXRcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5lYXNlKGQzLmVhc2VCYWNrSW4ub3ZlcnNob290KDEuNykpXG4gICAgICAgICAgICAuYXR0cihcInJcIiwgMClcbiAgICAgICAgICAgIC5yZW1vdmUoKVxuICAgICAgKTtcbiAgfVxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byB1cGRhdGUgZXJyb3IgbGluZXMgYmFzZWQgb24gbmV3IGRhdGEuXG4gIGZ1bmN0aW9uIHVwZGF0ZUVycm9yTGluZXMobGluZXMsIGRhdGEsIHRyYW5zaXRpb24gPSB0cnVlKSB7XG4gICAgY29uc3QgcmVncmVzc2lvbkRhdGEgPSBsaW5lYXJSZWdyZXNzaW9uKGRhdGEpO1xuXG4gICAgcmV0dXJuIGxpbmVzXG4gICAgICAuZGF0YShkYXRhLCAoZCkgPT4gZC5pZClcbiAgICAgIC5qb2luKFxuICAgICAgICAoZW50ZXIpID0+XG4gICAgICAgICAgZW50ZXJcbiAgICAgICAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAgICAgICAuYXR0cihcInN0cm9rZVwiLCBlcnJvckNvbG9yKVxuICAgICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMilcbiAgICAgICAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCBlcnJvckxpbmVzT3BhY2l0eSlcbiAgICAgICAgICAgIC8vIFN0YXJ0IGF0IGRhdGEgcG9pbnRcbiAgICAgICAgICAgIC5hdHRyKFwieDFcIiwgKGQpID0+IHhTY2FsZShkLnhDb29yZCkpXG4gICAgICAgICAgICAuYXR0cihcInkxXCIsIChkKSA9PiB5U2NhbGUoZC55Q29vcmQpKVxuICAgICAgICAgICAgLmF0dHIoXCJ4MlwiLCAoZCkgPT4geFNjYWxlKGQueENvb3JkKSlcbiAgICAgICAgICAgIC5hdHRyKFwieTJcIiwgKGQpID0+IHlTY2FsZShkLnlDb29yZCkpXG4gICAgICAgICAgICAvLyBBZGQgdHJhbnNpdGlvblxuICAgICAgICAgICAgLmNhbGwoKGVudGVyKSA9PlxuICAgICAgICAgICAgICBlbnRlclxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIChkKSA9PiB5U2NhbGUocmVncmVzc2lvbkRhdGEucHJlZGljdChkLnhDb29yZCkpKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgKHVwZGF0ZSkgPT5cbiAgICAgICAgICB1cGRhdGUuY2FsbCgodXBkYXRlKSA9PiB7XG4gICAgICAgICAgICBpZiAodHJhbnNpdGlvbikgdXBkYXRlID0gdXBkYXRlLnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgIHVwZGF0ZVxuICAgICAgICAgICAgICAuYXR0cihcIngxXCIsIChkKSA9PiB4U2NhbGUoZC54Q29vcmQpKVxuICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIChkKSA9PiB5U2NhbGUoZC55Q29vcmQpKVxuICAgICAgICAgICAgICAuYXR0cihcIngyXCIsIChkKSA9PiB4U2NhbGUoZC54Q29vcmQpKVxuICAgICAgICAgICAgICAuYXR0cihcInkyXCIsIChkKSA9PiB5U2NhbGUocmVncmVzc2lvbkRhdGEucHJlZGljdChkLnhDb29yZCkpKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgKGV4aXQpID0+XG4gICAgICAgICAgZXhpdFxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmF0dHIoXCJ5MlwiLCAoZCkgPT4geVNjYWxlKGQueUNvb3JkKSlcbiAgICAgICAgICAgIC5yZW1vdmUoKVxuICAgICAgKTtcbiAgfVxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byB1cGRhdGUgZXJyb3Igc3F1YXJlcyBiYXNlZCBvbiBuZXcgZGF0YS5cbiAgZnVuY3Rpb24gdXBkYXRlRXJyb3JTcXVhcmVzKHJlY3RzLCBkYXRhLCB0cmFuc2l0aW9uID0gdHJ1ZSkge1xuICAgIGNvbnN0IHJlZ3Jlc3Npb25EYXRhID0gbGluZWFyUmVncmVzc2lvbihkYXRhKTtcblxuICAgIGNvbnN0IGNvbXB1dGVIZWlnaHQgPSAoZCkgPT4ge1xuICAgICAgY29uc3QgeUNvb3JkUHJlZCA9IHJlZ3Jlc3Npb25EYXRhLnByZWRpY3QoZC54Q29vcmQpO1xuXG4gICAgICByZXR1cm4gTWF0aC5hYnMoeVNjYWxlKHlDb29yZFByZWQpIC0geVNjYWxlKGQueUNvb3JkKSk7XG4gICAgfTtcbiAgICAvLyBDb21wdXRlIHdoaWNoIGRpcmVjdGlvbiB0aGUgYm94IHNob3VsZCBmYWNlXG4gICAgY29uc3QgY29tcHV0ZVRyYW5zZm9ybSA9IChkKSA9PiB7XG4gICAgICBjb25zdCB5Q29vcmRQcmVkID0gcmVncmVzc2lvbkRhdGEucHJlZGljdChkLnhDb29yZCk7XG4gICAgICBjb25zdCBjaGVjayA9IHlTY2FsZSh5Q29vcmRQcmVkKSAtIHlTY2FsZShkLnlDb29yZCkgPCAwO1xuICAgICAgY29uc3QgZGVnID0gY2hlY2sgPyAtOTAgOiA5MDtcblxuICAgICAgcmV0dXJuIGByb3RhdGUoJHtkZWd9LCAke3hTY2FsZShkLnhDb29yZCl9LCAke3lTY2FsZShkLnlDb29yZCl9KWA7XG4gICAgfTtcblxuICAgIHJldHVybiByZWN0c1xuICAgICAgLmRhdGEoZGF0YSwgKGQpID0+IGQuaWQpXG4gICAgICAuam9pbihcbiAgICAgICAgKGVudGVyKSA9PlxuICAgICAgICAgIGVudGVyXG4gICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgZXJyb3JDb2xvcilcbiAgICAgICAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCBlcnJvclNxdWFyZXNPcGFjaXR5KVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY29tcHV0ZVRyYW5zZm9ybSlcbiAgICAgICAgICAgIC8vIFN0YXJ0IGF0IGRhdGEgcG9pbnRcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCAoZCkgPT4geFNjYWxlKGQueENvb3JkKSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCAoZCkgPT4geVNjYWxlKGQueUNvb3JkKSlcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgMClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDApXG4gICAgICAgICAgICAvLyBBZGQgdHJhbnNpdGlvblxuICAgICAgICAgICAgLmNhbGwoKGVudGVyKSA9PiB7XG4gICAgICAgICAgICAgIGVudGVyXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgY29tcHV0ZUhlaWdodClcbiAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBjb21wdXRlSGVpZ2h0KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAodXBkYXRlKSA9PlxuICAgICAgICAgIHVwZGF0ZS5jYWxsKCh1cGRhdGUpID0+IHtcbiAgICAgICAgICAgIHVwZGF0ZS5hdHRyKFwidHJhbnNmb3JtXCIsIGNvbXB1dGVUcmFuc2Zvcm0pO1xuXG4gICAgICAgICAgICBpZiAodHJhbnNpdGlvbikgdXBkYXRlID0gdXBkYXRlLnRyYW5zaXRpb24oKTtcblxuICAgICAgICAgICAgdXBkYXRlXG4gICAgICAgICAgICAgIC5hdHRyKFwieFwiLCAoZCkgPT4geFNjYWxlKGQueENvb3JkKSlcbiAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB5U2NhbGUoZC55Q29vcmQpKVxuICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGNvbXB1dGVIZWlnaHQpXG4gICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGNvbXB1dGVIZWlnaHQpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAoZXhpdCkgPT4gZXhpdC50cmFuc2l0aW9uKCkuYXR0cihcIndpZHRoXCIsIDApLmF0dHIoXCJoZWlnaHRcIiwgMCkucmVtb3ZlKClcbiAgICAgICk7XG4gIH1cblxuICAvLyBSZXNldHMgdGhlIHBsb3QgdG8gdGhlIGluaXRpYWwgZGF0YVxuICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICB1cGRhdGUoaW5pdERhdGEsIHRydWUpO1xuICB9XG5cbiAgLy8gVXBkYXRlcyB3aGljaCBlcnJvciB0eXBlIHRvIHNob3dcbiAgZnVuY3Rpb24gdXBkYXRlVmlldyhvcHRpb24pIHtcbiAgICBpZiAob3B0aW9uID09PSBcIk5vbmVcIikge1xuICAgICAgZXJyb3JMaW5lc09wYWNpdHkgPSAwO1xuICAgICAgZXJyb3JTcXVhcmVzT3BhY2l0eSA9IDA7XG5cbiAgICAgIGVycm9yTGluZXMudHJhbnNpdGlvbigpLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgZXJyb3JTcXVhcmVzLnRyYW5zaXRpb24oKS5hdHRyKFwib3BhY2l0eVwiLCAwKTtcbiAgICB9IGVsc2UgaWYgKG9wdGlvbiA9PT0gXCJBYnNvbHV0ZSBFcnJvclwiKSB7XG4gICAgICBlcnJvckxpbmVzT3BhY2l0eSA9IDE7XG4gICAgICBlcnJvclNxdWFyZXNPcGFjaXR5ID0gMDtcblxuICAgICAgZXJyb3JMaW5lcy50cmFuc2l0aW9uKCkuYXR0cihcIm9wYWNpdHlcIiwgMSk7XG4gICAgICBlcnJvclNxdWFyZXMudHJhbnNpdGlvbigpLmF0dHIoXCJvcGFjaXR5XCIsIDApO1xuICAgIH0gZWxzZSBpZiAob3B0aW9uID09PSBcIlNxdWFyZWQgRXJyb3JcIikge1xuICAgICAgZXJyb3JMaW5lc09wYWNpdHkgPSAwO1xuICAgICAgZXJyb3JTcXVhcmVzT3BhY2l0eSA9IDAuNTtcblxuICAgICAgZXJyb3JMaW5lcy50cmFuc2l0aW9uKCkuYXR0cihcIm9wYWNpdHlcIiwgMCk7XG4gICAgICBlcnJvclNxdWFyZXMudHJhbnNpdGlvbigpLmF0dHIoXCJvcGFjaXR5XCIsIDAuNSk7XG4gICAgfVxuICB9XG5cbiAgLy8gQWRkcyBhIG5ldyBkYXRhcG9pbnQgYW5kIHVwZGF0ZXMgdGhlIHBsb3RcbiAgZnVuY3Rpb24gdXBkYXRlRGF0YXBvaW50KHhDb29yZCwgeUNvb3JkKSB7XG4gICAgLy8gQWRkIGRhdGFwb2ludFxuICAgIGRhdGEgPSBbLi4uZGF0YSwgeyB4Q29vcmQsIHlDb29yZCwgaWQ6IGlkQ291bnRlcisrIH1dO1xuXG4gICAgdXBkYXRlKGRhdGEpO1xuICB9XG5cbiAgLy8gTWFpbiBmdW5jdGlvbiB0aGF0IHVwZGF0ZXMgdGhlIHBsb3QgYmFzZWQgb24gbmV3IGRhdGFcbiAgZnVuY3Rpb24gdXBkYXRlKG5ld0RhdGEsIHRyYW5zaXRpb24gPSB0cnVlKSB7XG4gICAgLy8gVXBhdGUgbG9jYWwgZGF0YSBvYmplY3RcbiAgICBkYXRhID0gbmV3RGF0YS5tYXAoKGQpID0+ICh7IC4uLmQgfSkpO1xuXG4gICAgdXBkYXRlUmVncmVzc2lvbkxpbmUocmVncmVzc2lvbkxpbmUsIGRhdGEsIHRyYW5zaXRpb24pO1xuICAgIGNpcmNsZXMgPSB1cGRhdGVDaXJjbGVzKGNpcmNsZXMsIGRhdGEpO1xuICAgIGVycm9yU3F1YXJlcyA9IHVwZGF0ZUVycm9yU3F1YXJlcyhlcnJvclNxdWFyZXMsIGRhdGEsIHRyYW5zaXRpb24pO1xuICAgIGVycm9yTGluZXMgPSB1cGRhdGVFcnJvckxpbmVzKGVycm9yTGluZXMsIGRhdGEsIHRyYW5zaXRpb24pO1xuICB9XG5cbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oc3ZnLm5vZGUoKSwge1xuICAgIHVwZGF0ZSxcbiAgICB1cGRhdGVEYXRhcG9pbnQsXG4gICAgdXBkYXRlVmlldyxcbiAgICByZXNldFxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImQzID0gcmVxdWlyZShcImQzLXJlZ3Jlc3Npb25cIiwgXCJkM1wiKVxuIn1dfQ==
</script><script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopiert");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopiert");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./070-zusammenhaenge.html" class="pagination-link" aria-label="Punktmodelle 2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Punktmodelle 2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./090-regression2.html" class="pagination-link" aria-label="Geradenmodelle 2">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Geradenmodelle 2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Powered by <a href="https://quarto.org">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="./impressum.qmd">Impressum</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sebastiansauer/statistik1/issues/new" class="toc-action"><i class="bi bi-github"></i>Problem melden</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><a href="./datenschutz.qmd">Datenschutzhinweise</a></p>
</div>
  </div>
</footer>


</body></html>